<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Task Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* NYU Perstare Font */
        @font-face {
            font-family: 'NYU Perstare';
            src: url('./NYUPerstare-Desktop-20250918/OpenTypeFonts/NYUPerstare-Regular.otf') format('opentype');
            font-weight: 400;
            font-style: normal;
        }
        @font-face {
            font-family: 'NYU Perstare';
            src: url('./NYUPerstare-Desktop-20250918/OpenTypeFonts/NYUPerstare-Medium.otf') format('opentype');
            font-weight: 500;
            font-style: normal;
        }
        @font-face {
            font-family: 'NYU Perstare';
            src: url('./NYUPerstare-Desktop-20250918/OpenTypeFonts/NYUPerstare-Bold.otf') format('opentype');
            font-weight: 700;
            font-style: normal;
        }
        @font-face {
            font-family: 'NYU Perstare';
            src: url('./NYUPerstare-Desktop-20250918/OpenTypeFonts/NYUPerstare-Black.otf') format('opentype');
            font-weight: 900;
            font-style: normal;
        }

        :root {
            /* NYU Brand Colors */
            --primary-color: #57068c;
            --primary-dark: #330a57;
            --primary-light: #7a1eb3;
            --primary-gradient: linear-gradient(135deg, #57068c 0%, #330a57 100%);

            /* Neutral Colors */
            --text-primary: #2d2d3a;
            --text-secondary: #5a5a6e;
            --text-tertiary: #8a8a9e;
            --background-color: #f7f5f9;
            --card-background: #ffffff;
            --header-background: #ffffff;
            --modal-background: #ffffff;
            --input-background: #ffffff;

            /* NYU Accent Colors - Violet Tints */
            --accent-purple-light: #8b4db8;
            --accent-purple-lighter: #c4a3d9;
            --accent-purple-lightest: #ebe0f5;

            /* UI Elements */
            --border-color: #e4e0eb;
            --border-color-strong: #c8c0d6;
            --card-border: 1px solid rgba(230, 225, 240, 0.8);

            /* Spacing Scale */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;

            /* Typography */
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;

            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 14px;
            --radius-xl: 20px;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-sm: 0 2px 8px rgba(87, 6, 140, 0.08);
            --shadow-md: 0 4px 16px rgba(87, 6, 140, 0.12);
            --shadow-lg: 0 8px 24px rgba(87, 6, 140, 0.16);
            --shadow-xl: 0 16px 48px rgba(87, 6, 140, 0.2);

            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            font-family: 'NYU Perstare', 'Montserrat', sans-serif;
            color: var(--text-primary);
            background-color: var(--background-color);
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .pomodoro-container {
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 80px);
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-lg);
        }

        @media (max-width: 768px) {
            .pomodoro-container {
                padding: var(--space-lg) var(--space-md);
                min-height: calc(100vh - 60px);
            }
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px 48px;
            background-color: var(--header-background);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        @media (max-width: 768px) {
            .header {
                padding: 12px 20px;
            }
        }

        .logo-container {
            height: 48px;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            cursor: pointer;
            transition: opacity var(--transition-fast);
            position: absolute;
            left: 48px;
        }

        .logo-container:hover {
            opacity: 0.8;
        }

        .logo-img {
            height: 100%;
            max-width: 200px;
            object-fit: contain;
        }

        @media (max-width: 768px) {
            .logo-container {
                height: 32px;
                left: 20px;
            }

            .logo-container img {
                max-width: 140px;
            }
        }

        .header-title {
            text-align: center;
        }

        #main-title {
            font-size: 1.75rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            font-weight: 700;
            letter-spacing: -0.03em;
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            transition: opacity var(--transition-fast);
        }

        #main-title:hover {
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            #main-title {
                font-size: 1.1rem;
            }
        }

        .header-buttons {
            display: flex;
            gap: 6px;
            align-items: center;
            flex-shrink: 0;
            position: absolute;
            right: 48px;
        }

        @media (max-width: 768px) {
            .header-buttons {
                right: 20px;
            }
        }

        /* Options Dropdown */
        .options-dropdown {
            position: relative;
            display: inline-block;
        }

        .toggle-btn {
            background: transparent;
            color: var(--primary-color);
            border: none;
            border-radius: var(--radius-sm);
            padding: 8px 14px;
            font-size: 1.4rem;
            font-weight: 300;
            cursor: pointer;
            transition: all var(--transition-fast);
            line-height: 1;
        }

        .toggle-btn:hover {
            background-color: var(--accent-purple-lightest);
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .toggle-btn {
                padding: 4px 8px;
                font-size: 1.2rem;
            }
        }

        .options-dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: calc(100% + 8px);
            background-color: var(--card-background);
            min-width: 220px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            border-radius: var(--radius-md);
            z-index: 1000;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .options-dropdown-menu.show {
            display: block;
            animation: dropdownFadeIn 0.2s ease-out;
        }

        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-item {
            display: block;
            width: 100%;
            padding: 14px 24px;
            text-align: left;
            background: none;
            border: none;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background-color: var(--accent-purple-lightest);
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .options-dropdown-menu {
                min-width: 200px;
                top: calc(100% + 5px);
            }

            .dropdown-item {
                padding: 12px 20px;
                font-size: 0.95rem;
            }
        }

        /* Timer Section */
        .timer-section {
            position: relative;
            padding: var(--space-xl);
            background: var(--card-background);
            margin-bottom: var(--space-xl);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 20px rgba(107, 45, 143, 0.12);
            border: none;
        }

        .timer-settings-btn {
            position: absolute;
            top: 40px;
            left: 40px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 16px;
            z-index: 10;
        }

        .timer-settings-btn:hover {
            background: var(--accent-purple-lightest);
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: scale(1.05);
        }

        .pomodoro-timer-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-md);
            position: relative;
            padding: var(--space-xl);
            background: linear-gradient(135deg, #faf9fc 0%, #f0eef5 100%);
            border-radius: var(--radius-md);
        }

        .session-type-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #3498db;
            margin-bottom: 2px;
        }

        .work-session .session-type-indicator {
            background-color: #3498db;
        }

        .short-break-session .session-type-indicator {
            background-color: #2ecc71;
        }

        .long-break-session .session-type-indicator {
            background-color: #9b59b6;
        }

        .pomodoro-time {
            font-size: 3.5rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            color: var(--text-primary);
            letter-spacing: -0.02em;
            line-height: 1;
        }

        .pomodoro-session-info {
            font-size: var(--font-size-base);
            color: var(--text-secondary);
            font-weight: 600;
            margin-top: var(--space-xs);
        }

        .timer-controls {
            display: flex;
            gap: var(--space-lg);
            margin-top: var(--space-lg);
        }

        .timer-btn {
            background: var(--card-background);
            border: 2px solid var(--border-color);
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 16px;
            transition: all var(--transition-fast);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .timer-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .timer-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Progress Bar */
        .timer-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background-color: var(--primary-color);
            transition: width 1s linear;
            border-radius: 0 0 var(--radius-md) var(--radius-md);
        }

        .work-session .timer-progress {
            background-color: #3498db;
        }

        .short-break-session .timer-progress {
            background-color: #2ecc71;
        }

        .long-break-session .timer-progress {
            background-color: #9b59b6;
        }

        /* Content Area */
        .pomodoro-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--card-background);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            box-shadow: 0 4px 20px rgba(107, 45, 143, 0.12);
            margin-bottom: var(--space-xl);
        }

        /* Lists Management */
        .no-list-message {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-2xl) var(--space-xl);
            color: var(--text-tertiary);
            text-align: center;
            gap: var(--space-lg);
        }

        .no-list-message i {
            font-size: 3rem;
            color: var(--accent-purple-lighter);
        }

        .no-list-message p {
            font-size: var(--font-size-lg);
            margin: 0;
        }

        .initial-options {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
            justify-content: center;
        }

        .initial-option-btn {
            border: none;
            border-radius: var(--radius-md);
            padding: 14px 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-weight: 600;
            font-size: var(--font-size-base);
            transition: all var(--transition-fast);
            box-shadow: 0 4px 12px rgba(107, 45, 143, 0.15);
        }

        .initial-option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(107, 45, 143, 0.25);
        }

        .initial-option-btn.create-btn {
            background: var(--primary-gradient);
            color: white;
        }

        .initial-option-btn.template-btn {
            background: var(--card-background);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .initial-option-btn.template-btn:hover {
            background: var(--accent-purple-lightest);
        }

        .list-content {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        /* List Title Bar */
        .list-title-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-xl);
            padding: 0 0 var(--space-lg) 0;
            border-bottom: 2px solid var(--border-color);
        }

        .list-title {
            font-family: 'NYU Perstare', 'Montserrat', sans-serif;
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0;
            flex: 1;
            line-height: 1.2;
        }

        .list-actions {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .list-action-btn {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            width: 38px;
            height: 38px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 15px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }

        .list-action-btn:hover {
            background: var(--accent-purple-lightest);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .list-action-btn:active {
            transform: scale(0.95);
        }

        .list-action-btn.danger-action-btn:hover {
            background: rgba(244, 67, 54, 0.1);
            border-color: #f44336;
            color: #f44336;
        }

        /* List Selector Dropdown */
        .list-selector-dropdown {
            position: relative;
            margin-bottom: var(--space-sm);
        }

        .list-selector-dropdown.hidden {
            display: none;
        }

        .list-dropdown-content {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .list-dropdown-header {
            padding: 12px var(--space-lg);
            background: var(--background-color);
            font-weight: 600;
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            border-bottom: 2px solid var(--border-color);
        }

        .list-dropdown-items {
            max-height: 300px;
            overflow-y: auto;
        }

        .list-dropdown-item {
            padding: 12px var(--space-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-color);
        }

        .list-dropdown-item:last-child {
            border-bottom: none;
        }

        .list-dropdown-item:hover {
            background: var(--accent-purple-lightest);
        }

        .list-dropdown-item.active {
            background: var(--accent-purple-lightest);
            color: var(--primary-color);
            font-weight: 600;
        }

        .list-dropdown-item-check {
            color: var(--primary-color);
            font-size: 14px;
        }

        /* Tasks Counter Bar */
        .tasks-counter-bar {
            margin-bottom: var(--space-lg);
        }

        #tasks-counter {
            font-size: var(--font-size-base);
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Tasks Container */
        .pomodoro-tasks-container {
            display: flex;
            flex-direction: column;
            min-height: 300px;
            max-height: 600px;
        }

        .pomodoro-task-list-wrapper {
            overflow-y: auto;
            padding: var(--space-xs) var(--space-md) var(--space-xs) 0;
        }

        .pomodoro-task-list {
            list-style: none;
        }

        /* Task Item Styles */
        .pomodoro-task-item {
            margin-bottom: 12px;
            position: relative;
        }

        .pomodoro-task-content {
            padding: var(--space-md);
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            transition: all var(--transition-fast);
            position: relative;
            border: 1px solid rgba(228, 224, 235, 0.5);
        }

        .pomodoro-task-content:hover {
            background-color: rgba(255, 255, 255, 0.95);
            border-color: var(--border-color);
            box-shadow: 0 2px 6px rgba(107, 45, 143, 0.08);
        }

        .pomodoro-task-checkbox {
            cursor: pointer;
            accent-color: var(--primary-color);
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .pomodoro-task-text {
            flex: 1;
            white-space: normal;
            word-break: break-word;
            color: var(--text-primary);
            font-size: var(--font-size-sm);
            line-height: 1.5;
        }

        .pomodoro-task-completed .pomodoro-task-text {
            text-decoration: line-through;
            color: var(--text-tertiary);
        }

        .pomodoro-task-controls {
            display: flex;
            gap: var(--space-xs);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .pomodoro-task-content:hover .pomodoro-task-controls {
            opacity: 1;
        }

        .pomodoro-task-btn {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid var(--border-color);
            cursor: pointer;
            width: 28px;
            height: 28px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            font-size: 12px;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .pomodoro-task-btn:hover {
            background-color: var(--accent-purple-lightest);
            color: var(--primary-color);
            border-color: var(--primary-light);
        }

        .pomodoro-task-delete:hover {
            background-color: rgba(244, 67, 54, 0.1);
            color: #f44336;
            border-color: #f44336;
        }

        .pomodoro-task-add-subtask {
            color: var(--primary-color);
        }

        .pomodoro-task-add-subtask:hover {
            background-color: var(--accent-purple-lightest);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* Subtasks Nesting */
        .pomodoro-subtasks {
            margin-left: var(--space-lg);
            margin-top: 12px;
            padding-left: var(--space-lg);
            border-left: 3px solid rgba(200, 192, 214, 0.4);
            list-style: none;
        }

        .pomodoro-subtasks .pomodoro-task-item {
            margin-bottom: 12px;
        }

        .pomodoro-subtasks .pomodoro-task-content {
            background-color: transparent;
            border-color: rgba(228, 224, 235, 0.3);
        }

        .pomodoro-subtasks .pomodoro-task-content:hover {
            background-color: rgba(255, 255, 255, 0.5);
            border-color: var(--border-color);
        }

        /* Expand/Collapse Indicator */
        .task-expand-indicator {
            color: var(--text-tertiary);
            cursor: pointer;
            transition: transform var(--transition-fast);
            font-size: 11px;
            width: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .task-expand-indicator.collapsed {
            transform: rotate(-90deg);
        }

        .task-expand-indicator:hover {
            color: var(--primary-color);
        }

        .pomodoro-task-item.collapsed .pomodoro-subtasks {
            display: none;
        }

        /* Inline Subtask Input */
        .inline-subtask-input {
            margin-bottom: var(--space-sm);
        }

        .inline-subtask-input .pomodoro-task-content {
            background-color: rgba(235, 229, 242, 0.8);
            padding: 10px 12px;
            gap: var(--space-sm);
            border-color: var(--primary-light);
        }

        .inline-task-input {
            flex: 1;
            border: 2px solid var(--primary-light);
            border-radius: var(--radius-sm);
            padding: 8px 12px;
            font-size: var(--font-size-sm);
            font-family: var(--font-primary);
            color: var(--text-primary);
            background-color: var(--input-background);
            outline: none;
            transition: border-color var(--transition-fast);
        }

        .inline-task-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(107, 45, 143, 0.1);
        }

        .inline-input-buttons {
            display: flex;
            gap: var(--space-xs);
        }

        .inline-input-btn {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
            background: rgba(255, 255, 255, 0.9);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .inline-input-btn.save {
            color: #4caf50;
            border-color: #4caf50;
        }

        .inline-input-btn.save:hover {
            background-color: rgba(76, 175, 80, 0.1);
            color: #2e7d32;
            border-color: #2e7d32;
        }

        .inline-input-btn.cancel {
            color: #f44336;
            border-color: #f44336;
        }

        .inline-input-btn.cancel:hover {
            background-color: rgba(244, 67, 54, 0.1);
            color: #c62828;
            border-color: #c62828;
        }

        /* Add Task Area */
        .pomodoro-add-task-area {
            padding: var(--space-lg) 0 0 0;
            border-top: 2px solid var(--border-color);
            margin-top: var(--space-lg);
        }

        .pomodoro-add-task {
            display: flex;
            gap: var(--space-md);
        }

        .pomodoro-add-task-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-family: var(--font-primary);
            font-size: var(--font-size-base);
            background-color: var(--input-background);
            transition: all var(--transition-fast);
            color: var(--text-primary);
        }

        .pomodoro-add-task-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(107, 45, 143, 0.15);
        }

        .pomodoro-add-task-input::placeholder {
            color: var(--text-tertiary);
        }

        .pomodoro-add-task-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            padding: 12px 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-weight: 600;
            font-size: var(--font-size-base);
            transition: all var(--transition-fast);
            box-shadow: 0 4px 12px rgba(107, 45, 143, 0.25);
        }

        .pomodoro-add-task-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .pomodoro-add-task-btn:active {
            transform: translateY(0);
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-panel {
            background-color: var(--modal-background);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 450px;
            max-height: 90vh;
            box-shadow: 0 12px 40px rgba(107, 45, 143, 0.25);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-xl);
            border-bottom: 2px solid var(--border-color);
        }

        .modal-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--primary-color);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 26px;
            color: var(--text-secondary);
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            background-color: var(--accent-purple-lightest);
            color: var(--primary-color);
        }

        .modal-body {
            padding: var(--space-xl);
            overflow-y: auto;
            flex: 1;
        }

        .modal-label {
            display: block;
            font-size: var(--font-size-base);
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: var(--space-md);
        }

        .modal-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-family: var(--font-primary);
            font-size: var(--font-size-base);
            background-color: var(--input-background);
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(107, 45, 143, 0.15);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--space-md);
            padding: var(--space-xl);
            border-top: 2px solid var(--border-color);
        }

        .modal-btn {
            padding: 12px 28px;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: none;
        }

        .modal-btn-secondary {
            background: var(--card-background);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .modal-btn-secondary:hover {
            background: var(--accent-purple-lightest);
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .modal-btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .modal-btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .modal-btn-primary:active {
            transform: translateY(0);
        }

        /* Konami Code Modal */
        .konami-panel {
            max-width: 800px;
            animation: konamiAppear 0.5s ease-out;
        }

        @keyframes konamiAppear {
            0% {
                opacity: 0;
                transform: scale(0.8) rotate(-5deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        .konami-body {
            padding: 0;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Templates Modal */
        .templates-panel {
            max-width: 600px;
        }

        .templates-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .template-card {
            padding: var(--space-lg);
            background: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .template-card:hover {
            border-color: var(--primary-color);
            background: var(--accent-purple-lightest);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .template-card-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--primary-color);
            margin: 0 0 var(--space-sm) 0;
        }

        .template-card-description {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.5;
        }

        .template-card-meta {
            margin-top: var(--space-sm);
            font-size: var(--font-size-sm);
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .template-card-meta i {
            font-size: 12px;
        }

        /* Share Modal */
        .share-modal-description {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: var(--space-lg);
        }

        .share-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .share-option-btn {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: left;
            width: 100%;
        }

        .share-option-btn:hover {
            border-color: var(--primary-color);
            background: var(--accent-purple-lightest);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .share-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .share-option-content {
            flex: 1;
        }

        .share-option-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .share-option-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .share-option-tag {
            background: var(--primary-gradient);
            color: white;
            font-size: 0.7rem;
            padding: 4px 10px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            transition: all 0.2s;
            white-space: nowrap;
        }

        /* Download/Upload Modals */
        .modal-description {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: var(--space-lg);
        }

        .download-list-options {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            max-height: 300px;
            overflow-y: auto;
        }

        .download-list-option {
            padding: var(--space-md);
            background: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .download-list-option:hover {
            border-color: var(--primary-color);
            background: var(--accent-purple-lightest);
        }

        .download-list-option.selected {
            border-color: var(--primary-color);
            background: var(--accent-purple-lightest);
        }

        .download-list-option-radio {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid var(--border-color-strong);
            position: relative;
        }

        .download-list-option.selected .download-list-option-radio {
            border-color: var(--primary-color);
        }

        .download-list-option.selected .download-list-option-radio::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary-color);
        }

        .download-list-option-name {
            flex: 1;
            font-weight: 500;
            color: var(--text-primary);
        }

        .download-list-option-count {
            font-size: 0.85rem;
            color: var(--text-tertiary);
            padding: 4px 10px;
            background: var(--card-background);
            border-radius: var(--radius-sm);
        }

        .upload-option-section {
            margin-bottom: var(--space-lg);
        }

        .upload-option-label {
            display: block;
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: var(--text-primary);
        }

        .upload-drop-zone {
            border: 2px dashed var(--border-color-strong);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            text-align: center;
            background: var(--background-color);
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .upload-drop-zone:hover {
            border-color: var(--primary-color);
            background: var(--accent-purple-lightest);
        }

        .upload-drop-zone.drag-over {
            border-color: var(--primary-color);
            background: var(--accent-purple-lightest);
            transform: scale(1.02);
        }

        .upload-drop-zone-content {
            pointer-events: none;
        }

        .upload-drop-zone-icon {
            font-size: 2rem;
            display: block;
            margin-bottom: var(--space-sm);
        }

        .upload-drop-zone-text {
            color: var(--text-primary);
            font-weight: 500;
            margin: 0 0 var(--space-xs) 0;
        }

        .upload-drop-zone-subtext {
            color: var(--text-tertiary);
            font-size: 0.85rem;
            margin: var(--space-sm) 0;
        }

        .upload-drop-zone-button {
            display: inline-block;
            padding: var(--space-sm) var(--space-lg);
            background: var(--primary-gradient);
            color: white;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            pointer-events: all;
        }

        .upload-drop-zone-button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .upload-divider {
            text-align: center;
            color: var(--text-tertiary);
            margin: var(--space-lg) 0;
            font-size: 0.9rem;
        }

        .upload-json-textarea {
            width: 100%;
            min-height: 120px;
            padding: var(--space-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            resize: vertical;
            background: var(--background-color);
            color: var(--text-primary);
        }

        .upload-json-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* Settings Overlay */
        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .settings-overlay.active {
            display: flex;
        }

        .settings-panel {
            background-color: var(--modal-background);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 520px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 12px 40px rgba(107, 45, 143, 0.25);
            display: flex;
            flex-direction: column;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-xl);
            border-bottom: 2px solid var(--border-color);
        }

        .settings-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--primary-color);
            font-family: 'NYU Perstare', 'Montserrat', sans-serif;
        }

        .settings-close {
            background: none;
            border: none;
            font-size: 26px;
            color: var(--text-secondary);
            cursor: pointer;
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }

        .settings-close:hover {
            background-color: var(--accent-purple-lightest);
            color: var(--primary-color);
        }

        .settings-content {
            padding: var(--space-xl);
            overflow-y: auto;
        }

        .settings-section {
            margin-bottom: var(--space-2xl);
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-section-title {
            font-weight: 600;
            margin-bottom: var(--space-lg);
            color: var(--primary-color);
            font-size: var(--font-size-lg);
        }

        .settings-group {
            margin-bottom: var(--space-xl);
        }

        .settings-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-sm);
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            font-weight: 500;
        }

        .settings-value {
            font-weight: 600;
            color: var(--primary-color);
            font-size: var(--font-size-base);
        }

        .settings-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--border-color);
            outline: none;
            border-radius: var(--radius-sm);
        }

        .settings-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            box-shadow: var(--shadow-sm);
        }

        .settings-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
            box-shadow: var(--shadow-sm);
        }

        .settings-radio {
            margin-bottom: var(--space-sm);
            display: flex;
            align-items: center;
        }

        .settings-radio input[type="radio"] {
            margin-right: var(--space-sm);
            accent-color: var(--primary-color);
            width: 18px;
            height: 18px;
        }

        .settings-radio label {
            font-size: var(--font-size-sm);
            cursor: pointer;
            color: var(--text-primary);
        }

        .settings-footer {
            display: flex;
            justify-content: flex-end;
            padding: var(--space-xl);
            border-top: 2px solid var(--border-color);
        }

        .settings-save-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            padding: 12px 28px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-sm);
            font-size: var(--font-size-base);
        }

        .settings-save-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .settings-save-btn:active {
            transform: translateY(0);
        }

        /* Deadline Dropdown */
        .task-deadline-dropdown {
            position: relative;
            margin-left: auto;
        }

        .deadline-badge {
            padding: 5px 10px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            background: var(--accent-purple-lightest);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            white-space: nowrap;
        }

        .deadline-badge:hover {
            background: var(--accent-purple-lighter);
            color: var(--primary-color);
        }

        .deadline-badge.today {
            background: #ffebee;
            color: #c62828;
            border-color: #ef5350;
        }

        .deadline-badge.week {
            background: #fff3e0;
            color: #e65100;
            border-color: #ff9800;
        }

        .deadline-badge.next-week {
            background: #e3f2fd;
            color: #1565c0;
            border-color: #42a5f5;
        }

        .deadline-badge.month {
            background: #f3e5f5;
            color: var(--primary-color);
            border-color: var(--primary-light);
        }

        .deadline-badge.overdue {
            background: #d32f2f;
            color: white;
            border-color: #b71c1c;
            font-weight: 600;
        }

        .deadline-options {
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 6px;
            background: var(--card-background);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            z-index: 100;
            min-width: 220px;
            display: none;
        }

        .deadline-options.show {
            display: block;
        }

        .deadline-option {
            padding: 12px 16px;
            cursor: pointer;
            transition: background var(--transition-fast);
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
        }

        .deadline-option:last-child {
            border-bottom: none;
        }

        .deadline-option:hover {
            background: var(--accent-purple-lightest);
            color: var(--primary-color);
        }

        .deadline-option.clear {
            color: var(--text-tertiary);
        }

        .deadline-option.clear:hover {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
        }

        /* Deadline View Styles */
        .deadline-view-section {
            margin-bottom: var(--space-xl);
        }

        .deadline-section-header {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: var(--space-md);
            padding: var(--space-md) var(--space-lg);
            background: var(--accent-purple-lightest);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--primary-color);
        }

        .deadline-section-header.overdue {
            color: #c62828;
            background: #ffebee;
            border-left-color: #d32f2f;
        }

        .deadline-section-header.today {
            color: #e65100;
            background: #fff3e0;
            border-left-color: #ff9800;
        }

        .deadline-section-header.week {
            color: #1565c0;
            background: #e3f2fd;
            border-left-color: #42a5f5;
        }

        .deadline-section-count {
            font-size: var(--font-size-sm);
            color: var(--text-tertiary);
            font-weight: 400;
            margin-left: var(--space-sm);
        }

        .view-toggle-active {
            background: var(--primary-color) !important;
            color: white !important;
            border-color: var(--primary-color) !important;
        }

        /* Empty State */
        .pomodoro-no-tasks {
            padding: var(--space-xl);
            text-align: center;
            color: var(--text-tertiary);
            font-style: italic;
            font-size: var(--font-size-sm);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color-strong);
            border-radius: var(--radius-sm);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-light);
        }

        /* Hidden */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo-container">
            <img src="https://i.imgur.com/iIODsNl.png" alt="NYU Logo" class="logo-img">
        </div>
        <div class="header-title">
            <h1 id="main-title">Pomodoro</h1>
        </div>
        <div class="header-buttons">
            <div class="options-dropdown">
                <button class="toggle-btn" id="optionsDropdownBtn" title="Options"></button>
                <div class="options-dropdown-menu" id="optionsDropdownMenu">
                    <button class="dropdown-item" id="aboutBtn">About</button>
                    <button class="dropdown-item" id="reportBugBtn">Report Bug</button>
                    <button class="dropdown-item" id="shareEmailBtn">Share via Email</button>
                    <button class="dropdown-item" id="exportDataBtn">Download List</button>
                    <button class="dropdown-item" id="importDataBtn">Upload List</button>
                    <button class="dropdown-item" id="resetDataBtn">Reset All Data</button>
                </div>
            </div>
        </div>
    </header>

    <div class="pomodoro-container">
        <div class="timer-section">
            <button id="settings-button" class="timer-settings-btn" title="Timer Settings">
                <i class="fas fa-cog"></i>
            </button>
            <div class="pomodoro-timer-display work-session">
                <div class="session-type-indicator"></div>
                <div id="pomodoro-time" class="pomodoro-time">25:00</div>
                <div id="pomodoro-session" class="pomodoro-session-info">Work 1/4</div>
                <div class="timer-controls">
                    <button id="pomodoro-start" class="timer-btn" aria-label="Start timer">
                        <i class="fas fa-play"></i>
                    </button>
                    <button id="pomodoro-reset" class="timer-btn" aria-label="Reset timer">
                        <i class="fas fa-redo-alt"></i>
                    </button>
                    <button id="pomodoro-skip" class="timer-btn" aria-label="Skip to next session">
                        <i class="fas fa-forward"></i>
                    </button>
                </div>
                <div class="timer-progress" style="width: 0%;"></div>
            </div>
        </div>

        <main class="pomodoro-content">
            <div id="no-list-message" class="no-list-message">
                <i class="fas fa-clipboard-list"></i>
                <p>Get started with a new list or choose a template</p>
                <div class="initial-options">
                    <button id="create-first-list-btn" class="initial-option-btn create-btn">
                        <i class="fas fa-plus"></i> Create New List
                    </button>
                    <button id="browse-templates-btn" class="initial-option-btn template-btn">
                        <i class="fas fa-layer-group"></i> Browse Templates
                    </button>
                </div>
            </div>

            <div id="list-content" class="list-content" style="display: none;">
                <div class="list-title-bar">
                    <h2 id="current-list-name" class="list-title">Tasks</h2>
                    <div class="list-actions">
                        <button id="view-toggle-btn" class="list-action-btn" title="Toggle deadline view">
                            <i class="fas fa-calendar-alt"></i>
                        </button>
                        <button id="share-current-list-btn" class="list-action-btn" title="Share this list">
                            <i class="fas fa-share-alt"></i>
                        </button>
                        <button id="list-selector-btn" class="list-action-btn" title="Switch list">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <button id="add-list-btn" class="list-action-btn" title="Create new list">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button id="delete-list-btn" class="list-action-btn danger-action-btn" title="Delete current list">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>

                <div id="list-selector-dropdown" class="list-selector-dropdown hidden">
                    <div class="list-dropdown-content">
                        <div class="list-dropdown-header">Switch List</div>
                        <div id="list-dropdown-items" class="list-dropdown-items">
                            <!-- List items will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="tasks-counter-bar">
                    <span id="tasks-counter">0/0 completed</span>
                </div>

                <div class="pomodoro-tasks-container">
                    <div class="pomodoro-task-list-wrapper">
                        <ul id="pomodoro-tasks" class="pomodoro-task-list">
                            <!-- Tasks will be added here -->
                        </ul>
                    </div>

                    <div class="pomodoro-add-task-area">
                        <div class="pomodoro-add-task">
                            <input type="text" id="new-task-input" class="pomodoro-add-task-input" placeholder="Add a new task...">
                            <button id="add-task-btn" class="pomodoro-add-task-btn">
                                <i class="fas fa-plus"></i> Add Task
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- List Name Modal -->
        <div id="list-name-modal" class="modal-overlay">
            <div class="modal-panel">
                <div class="modal-header">
                    <h3 class="modal-title">Create New List</h3>
                    <button id="list-modal-close" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <label class="modal-label">List Name</label>
                    <input type="text" id="list-name-input" class="modal-input" placeholder="e.g., History Essay, Shopping, Work Tasks...">
                </div>
                <div class="modal-footer">
                    <button id="list-modal-cancel" class="modal-btn modal-btn-secondary">Cancel</button>
                    <button id="list-modal-save" class="modal-btn modal-btn-primary">Create List</button>
                </div>
            </div>
        </div>

        <!-- Custom Date Picker Modal -->
        <div id="custom-date-modal" class="modal-overlay">
            <div class="modal-panel">
                <div class="modal-header">
                    <h3 class="modal-title">Set Custom Deadline</h3>
                    <button id="date-modal-close" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <label class="modal-label">Select Date</label>
                    <input type="date" id="custom-date-input" class="modal-input">
                </div>
                <div class="modal-footer">
                    <button id="date-modal-cancel" class="modal-btn modal-btn-secondary">Cancel</button>
                    <button id="date-modal-save" class="modal-btn modal-btn-primary">Set Deadline</button>
                </div>
            </div>
        </div>

        <!-- Templates Modal -->
        <div id="templates-modal" class="modal-overlay">
            <div class="modal-panel templates-panel">
                <div class="modal-header">
                    <h3 class="modal-title">Choose a Template</h3>
                    <button id="templates-modal-close" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="templates-list" class="templates-list">
                        <!-- Templates will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Konami Code Easter Egg Modal -->
        <div id="konami-modal" class="modal-overlay">
            <div class="modal-panel konami-panel">
                <div class="modal-header">
                    <h3 class="modal-title"> You found the secret! </h3>
                    <button id="konami-modal-close" class="modal-close">&times;</button>
                </div>
                <div class="modal-body konami-body">
                    <div class="video-container">
                        <iframe id="konami-video" width="100%" height="400" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                </div>
            </div>
        </div>

        <!-- Share List Modal -->
        <div id="share-modal" class="modal-overlay">
            <div class="modal-panel">
                <div class="modal-header">
                    <h3 class="modal-title">Share List</h3>
                    <button id="share-modal-close" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="share-modal-description">
                        Share "<strong id="share-list-name"></strong>" with others
                    </p>
                    <div class="share-options">
                        <button class="share-option-btn" id="shareListEmailBtn">
                            <span class="share-icon"></span>
                            <div class="share-option-content">
                                <div class="share-option-title">Share via Email</div>
                                <div class="share-option-desc">Open email client with list data</div>
                            </div>
                            <span class="share-option-tag">simplest</span>
                        </button>

                        <button class="share-option-btn" id="shareListDownloadBtn">
                            <span class="share-icon"></span>
                            <div class="share-option-content">
                                <div class="share-option-title">Download as File</div>
                                <div class="share-option-desc">Save as .json file to share manually</div>
                            </div>
                        </button>

                        <button class="share-option-btn" id="shareListCopyBtn">
                            <span class="share-icon"></span>
                            <div class="share-option-content">
                                <div class="share-option-title">Copy List Data</div>
                                <div class="share-option-desc">Copy list data to clipboard</div>
                            </div>
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="share-modal-cancel" class="modal-btn modal-btn-secondary">Close</button>
                </div>
            </div>
        </div>

        <!-- Download List Modal -->
        <div id="download-modal" class="modal-overlay">
            <div class="modal-panel">
                <div class="modal-header">
                    <h3 class="modal-title">Download List</h3>
                    <button id="download-modal-close" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="modal-description">
                        Select a list to download as a .json file.
                    </p>
                    <div id="download-list-options" class="download-list-options">
                        <!-- List options will be populated here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="download-modal-cancel" class="modal-btn modal-btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Upload List Modal -->
        <div id="upload-modal" class="modal-overlay">
            <div class="modal-panel">
                <div class="modal-header">
                    <h3 class="modal-title">Upload List</h3>
                    <button id="upload-modal-close" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="modal-description">
                        Upload a .json list file or paste list file data
                    </p>

                    <div class="upload-option-section">
                        <label class="upload-option-label">Option 1: Upload File</label>
                        <div id="upload-drop-zone" class="upload-drop-zone">
                            <div class="upload-drop-zone-content">
                                <span class="upload-drop-zone-icon"></span>
                                <p class="upload-drop-zone-text">Drag & drop .json file here</p>
                                <p class="upload-drop-zone-subtext">or</p>
                                <label for="upload-file-input" class="upload-drop-zone-button">Choose File</label>
                                <input type="file" id="upload-file-input" accept=".json" style="display: none;">
                            </div>
                        </div>
                    </div>

                    <div class="upload-divider"> or </div>

                    <div class="upload-option-section">
                        <label class="upload-option-label">Option 2: Paste .json File Data</label>
                        <textarea
                            id="upload-json-textarea"
                            class="upload-json-textarea"
                            placeholder="Paste list file data here..."
                        ></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="upload-modal-confirm" class="modal-btn modal-btn-primary">Upload</button>
                    <button id="upload-modal-cancel" class="modal-btn modal-btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Settings overlay -->
        <div id="settings-overlay" class="settings-overlay">
            <div class="settings-panel">
                <div class="settings-header">
                    <h2 class="settings-title">Pomodoro Settings</h2>
                    <button id="settings-close" class="settings-close">&times;</button>
                </div>
                <div class="settings-content">
                    <div class="settings-section">
                        <h3 class="settings-section-title">Timer Settings</h3>

                        <div class="settings-group">
                            <label class="settings-label">
                                Work Duration
                                <span id="work-duration-value" class="settings-value">25</span> min
                            </label>
                            <input type="range" id="work-duration" class="settings-slider" min="5" max="60" step="1" value="25">
                        </div>

                        <div class="settings-group">
                            <label class="settings-label">
                                Short Break
                                <span id="short-break-value" class="settings-value">5</span> min
                            </label>
                            <input type="range" id="short-break" class="settings-slider" min="1" max="15" step="1" value="5">
                        </div>

                        <div class="settings-group">
                            <label class="settings-label">
                                Long Break
                                <span id="long-break-value" class="settings-value">15</span> min
                            </label>
                            <input type="range" id="long-break" class="settings-slider" min="10" max="30" step="1" value="15">
                        </div>

                        <div class="settings-group">
                            <label class="settings-label">
                                Sessions Before Long Break
                                <span id="sessions-value" class="settings-value">4</span>
                            </label>
                            <input type="range" id="sessions-count" class="settings-slider" min="2" max="6" step="1" value="4">
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="settings-section-title">Task Display</h3>

                        <div class="settings-group">
                            <div class="settings-radio">
                                <input type="radio" id="strikethrough" name="completed-display" value="strikethrough" checked>
                                <label for="strikethrough">Show completed tasks with strikethrough</label>
                            </div>
                            <div class="settings-radio">
                                <input type="radio" id="hide" name="completed-display" value="hide">
                                <label for="hide">Hide completed tasks</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-footer">
                    <button id="save-settings" class="settings-save-btn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Pomodoro Timer State
        const pomodoroState = {
            timerState: {
                timeRemaining: 25 * 60,
                currentSession: 'work',
                isRunning: false,
                timerInterval: null,
                startTime: null,
                pauseTime: null,
                sessionCount: 0
            },
            timerSettings: {
                workDuration: 25,
                shortBreakDuration: 5,
                longBreakDuration: 15,
                sessionsBeforeLongBreak: 4,
                completedTasksDisplay: 'strikethrough'
            },
            lists: [],
            currentListId: null,
            viewMode: 'normal',
            currentDeadlineTaskId: null,
            deadlineUpdateInterval: null,
            lastUpdateDate: null
        };

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            initializeEventListeners();
            updateTimerDisplay();
            startDeadlineAutoUpdate();
            requestNotificationPermission();
        });

        // Cleanup on unload
        window.addEventListener('beforeunload', function() {
            if (pomodoroState.deadlineUpdateInterval) {
                clearInterval(pomodoroState.deadlineUpdateInterval);
            }
        });

        // Request notification permission
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        // Initialize event listeners
        function initializeEventListeners() {
            // Timer controls
            document.getElementById('pomodoro-start').addEventListener('click', toggleTimer);
            document.getElementById('pomodoro-reset').addEventListener('click', resetTimer);
            document.getElementById('pomodoro-skip').addEventListener('click', skipCurrentSession);

            // Settings
            document.getElementById('settings-button').addEventListener('click', showSettings);
            document.getElementById('settings-close').addEventListener('click', hideSettings);
            document.getElementById('save-settings').addEventListener('click', function() {
                saveSettings();
                hideSettings();
            });

            // Options dropdown
            document.getElementById('optionsDropdownBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                toggleOptionsDropdown();
            });

            // Dropdown menu items
            document.getElementById('aboutBtn').addEventListener('click', showAbout);
            document.getElementById('reportBugBtn').addEventListener('click', reportBug);
            document.getElementById('shareEmailBtn').addEventListener('click', shareViaEmail);
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            document.getElementById('importDataBtn').addEventListener('click', importData);
            document.getElementById('resetDataBtn').addEventListener('click', resetAllData);

            // List management
            document.getElementById('create-first-list-btn').addEventListener('click', createNewList);
            document.getElementById('add-list-btn').addEventListener('click', createNewList);
            document.getElementById('delete-list-btn').addEventListener('click', deleteCurrentList);
            document.getElementById('share-current-list-btn').addEventListener('click', () => {
                if (pomodoroState.currentListId) {
                    showShareModal(pomodoroState.currentListId);
                }
            });
            document.getElementById('list-selector-btn').addEventListener('click', toggleListDropdown);
            document.getElementById('view-toggle-btn').addEventListener('click', toggleViewMode);

            // Templates modal
            document.getElementById('browse-templates-btn').addEventListener('click', showTemplatesModal);
            document.getElementById('templates-modal-close').addEventListener('click', hideTemplatesModal);

            // Task management
            document.getElementById('add-task-btn').addEventListener('click', () => addTask());
            document.getElementById('new-task-input').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    addTask();
                }
            });

            // Settings sliders
            setupSlider('work-duration', 'work-duration-value');
            setupSlider('short-break', 'short-break-value');
            setupSlider('long-break', 'long-break-value');
            setupSlider('sessions-count', 'sessions-value');

            // Close settings overlay when clicking outside
            document.getElementById('settings-overlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideSettings();
                }
            });

            // Close templates modal when clicking outside
            document.getElementById('templates-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideTemplatesModal();
                }
            });

            // Konami code modal
            document.getElementById('konami-modal-close').addEventListener('click', hideKonamiModal);
            document.getElementById('konami-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideKonamiModal();
                }
            });

            // Close list dropdown when clicking outside
            document.addEventListener('click', function(e) {
                const dropdown = document.getElementById('list-selector-dropdown');
                const selectorBtn = document.getElementById('list-selector-btn');
                if (!dropdown.classList.contains('hidden') &&
                    !dropdown.contains(e.target) &&
                    e.target !== selectorBtn &&
                    !selectorBtn.contains(e.target)) {
                    hideListDropdown();
                }
            });

            // Close options dropdown when clicking outside
            document.addEventListener('click', function(e) {
                const optionsMenu = document.getElementById('optionsDropdownMenu');
                const optionsBtn = document.getElementById('optionsDropdownBtn');
                if (optionsMenu.classList.contains('show') &&
                    !optionsMenu.contains(e.target) &&
                    e.target !== optionsBtn &&
                    !optionsBtn.contains(e.target)) {
                    optionsMenu.classList.remove('show');
                }
            });

            // List name modal
            document.getElementById('list-modal-close').addEventListener('click', hideListNameModal);
            document.getElementById('list-modal-cancel').addEventListener('click', hideListNameModal);
            document.getElementById('list-modal-save').addEventListener('click', saveNewListName);
            document.getElementById('list-name-input').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    saveNewListName();
                } else if (e.key === 'Escape') {
                    hideListNameModal();
                }
            });

            // Close modal when clicking outside
            document.getElementById('list-name-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideListNameModal();
                }
            });

            // Custom date modal
            document.getElementById('date-modal-close').addEventListener('click', hideCustomDateModal);
            document.getElementById('date-modal-cancel').addEventListener('click', hideCustomDateModal);
            document.getElementById('date-modal-save').addEventListener('click', saveCustomDate);
            document.getElementById('custom-date-input').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    saveCustomDate();
                } else if (e.key === 'Escape') {
                    hideCustomDateModal();
                }
            });

            // Close custom date modal when clicking outside
            document.getElementById('custom-date-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideCustomDateModal();
                }
            });

            // Share modal
            document.getElementById('share-modal-close').addEventListener('click', hideShareModal);
            document.getElementById('share-modal-cancel').addEventListener('click', hideShareModal);
            document.getElementById('shareListEmailBtn').addEventListener('click', shareListViaEmail);
            document.getElementById('shareListDownloadBtn').addEventListener('click', shareListDownload);
            document.getElementById('shareListCopyBtn').addEventListener('click', shareListCopyToClipboard);

            // Close share modal when clicking outside
            document.getElementById('share-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideShareModal();
                }
            });

            // Download modal
            document.getElementById('download-modal-close').addEventListener('click', hideDownloadModal);
            document.getElementById('download-modal-cancel').addEventListener('click', hideDownloadModal);
            document.getElementById('download-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideDownloadModal();
                }
            });

            // Upload modal
            document.getElementById('upload-modal-close').addEventListener('click', hideUploadModal);
            document.getElementById('upload-modal-cancel').addEventListener('click', hideUploadModal);
            document.getElementById('upload-modal-confirm').addEventListener('click', confirmUpload);
            document.getElementById('upload-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideUploadModal();
                }
            });

            // Upload file input
            document.getElementById('upload-file-input').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        processUploadedList(event.target.result);
                    };
                    reader.readAsText(file);
                }
            });

            // Upload drag and drop
            const uploadDropZone = document.getElementById('upload-drop-zone');

            uploadDropZone.addEventListener('click', () => {
                document.getElementById('upload-file-input').click();
            });

            uploadDropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadDropZone.classList.add('drag-over');
            });

            uploadDropZone.addEventListener('dragleave', () => {
                uploadDropZone.classList.remove('drag-over');
            });

            uploadDropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadDropZone.classList.remove('drag-over');

                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/json') {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        processUploadedList(event.target.result);
                    };
                    reader.readAsText(file);
                } else {
                    alert('Please drop a .json file');
                }
            });

            // Close deadline dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.task-deadline-dropdown')) {
                    document.querySelectorAll('.deadline-options.show').forEach(dropdown => {
                        dropdown.classList.remove('show');
                    });
                }
            });

            // Konami Code Easter Egg
            initKonamiCode();
        }

        // List Management Functions
        function createNewList() {
            showListNameModal();
        }

        function showListNameModal() {
            const modal = document.getElementById('list-name-modal');
            const input = document.getElementById('list-name-input');
            modal.style.display = 'flex';
            input.value = '';
            setTimeout(() => input.focus(), 100);
        }

        function hideListNameModal() {
            const modal = document.getElementById('list-name-modal');
            modal.style.display = 'none';
        }

        function saveNewListName() {
            const input = document.getElementById('list-name-input');
            const listName = input.value.trim();

            if (!listName) return;

            const newList = {
                id: 'list-' + Date.now(),
                name: listName,
                tasks: []
            };

            pomodoroState.lists.push(newList);
            pomodoroState.currentListId = newList.id;

            hideListNameModal();
            showListContent();
            renderTasks();
            saveData();
        }

        function deleteCurrentList() {
            if (!pomodoroState.currentListId) return;

            const currentList = getCurrentList();
            if (!currentList) return;

            if (!confirm(`Delete "${currentList.name}"? This cannot be undone.`)) return;

            pomodoroState.lists = pomodoroState.lists.filter(l => l.id !== pomodoroState.currentListId);
            pomodoroState.currentListId = pomodoroState.lists.length > 0 ? pomodoroState.lists[0].id : null;

            if (pomodoroState.currentListId) {
                showListContent();
                renderTasks();
            } else {
                hideListContent();
            }
            saveData();
        }

        function downloadCurrentList() {
            if (!pomodoroState.currentListId) return;

            const currentList = getCurrentList();
            if (!currentList) return;

            // Create a clean copy without the ID (so it generates a new one on import)
            const listToExport = {
                name: currentList.name,
                tasks: currentList.tasks,
                exportDate: new Date().toISOString(),
                exportedFrom: 'Pomodoro Task Manager'
            };

            const dataStr = JSON.stringify(listToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;

            // Create a safe filename from the list name
            const safeFileName = currentList.name.replace(/[^a-z0-9]/gi, '-').toLowerCase();
            link.download = `pomodoro-list-${safeFileName}-${new Date().toISOString().split('T')[0]}.json`;

            link.click();
            URL.revokeObjectURL(url);
        }

        function uploadList() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const importedList = JSON.parse(event.target.result);

                            // Validate the imported list has required fields
                            if (!importedList.name || !importedList.tasks) {
                                alert('Error: Invalid list file format');
                                return;
                            }

                            // Check if a list with this name already exists
                            const existingList = pomodoroState.lists.find(l => l.name === importedList.name);
                            let listName = importedList.name;

                            if (existingList) {
                                const shouldRename = confirm(`A list named "${listName}" already exists. Would you like to rename the imported list?\n\nClick OK to rename, or Cancel to replace the existing list.`);

                                if (shouldRename) {
                                    // Add a number suffix to make it unique
                                    let counter = 1;
                                    let newName = `${listName} (${counter})`;
                                    while (pomodoroState.lists.find(l => l.name === newName)) {
                                        counter++;
                                        newName = `${listName} (${counter})`;
                                    }
                                    listName = newName;
                                } else {
                                    // Remove the existing list
                                    pomodoroState.lists = pomodoroState.lists.filter(l => l.id !== existingList.id);
                                }
                            }

                            // Create new list with a unique ID
                            const newList = {
                                id: 'list-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                                name: listName,
                                tasks: importedList.tasks
                            };

                            pomodoroState.lists.push(newList);
                            pomodoroState.currentListId = newList.id;

                            saveData();
                            showListContent();
                            renderTasks();

                            alert(`Successfully imported list: "${listName}"`);
                        } catch (error) {
                            alert('Error importing list: Invalid file format');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Share Modal Functions
        let listToShareId = null;

        function showShareModal(listId) {
            listToShareId = listId;
            const list = pomodoroState.lists.find(l => l.id === listId);
            if (!list) return;

            document.getElementById('share-list-name').textContent = list.name;
            document.getElementById('share-modal').classList.add('active');
        }

        function hideShareModal() {
            document.getElementById('share-modal').classList.remove('active');
            listToShareId = null;
        }

        function shareListViaEmail() {
            if (!listToShareId) return;

            const list = pomodoroState.lists.find(l => l.id === listToShareId);
            if (!list) return;

            const listName = list.name;
            const taskCount = list.tasks.length;

            const listData = {
                name: list.name,
                tasks: list.tasks,
                exportDate: new Date().toISOString(),
                exportedFrom: 'Pomodoro Task Manager'
            };

            const subject = encodeURIComponent(`Shared Task List: ${listName}`);
            const body = encodeURIComponent(
                `Hi there!\n\n` +
                `I'm sharing a Pomodoro task list with you: "${listName}"\n` +
                `This list contains ${taskCount} task${taskCount !== 1 ? 's' : ''}.\n\n` +
                `===========================================\n` +
                `HOW TO IMPORT THIS LIST (for the recipient):\n` +
                `===========================================\n\n` +
                `STEP 1: Copy the .json file data\n` +
                `    Scroll down to the bottom of this email\n` +
                `    Select ALL the text between "START COPYING HERE" and "STOP COPYING HERE"\n` +
                `    Copy it (Cmd+C or Ctrl+C)\n\n` +
                `STEP 2: Open the Pomodoro Task Manager\n` +
                `    Visit: [Your Pomodoro app URL]\n\n` +
                `STEP 3: Upload the list\n` +
                `    Click the Options button () in the top-right corner\n` +
                `    Select "Upload List"\n` +
                `    Choose the file you saved, or paste the data directly\n\n` +
                `That's it! The task list will appear in your Pomodoro app.\n\n\n` +
                `\n` +
                `>>> START COPYING HERE <<<\n` +
                `\n\n` +
                `${JSON.stringify(listData, null, 2)}\n\n` +
                `\n` +
                `>>> STOP COPYING HERE <<<\n` +
                ``
            );

            window.location.href = `mailto:?subject=${subject}&body=${body}`;
            hideShareModal();
        }

        function shareListDownload() {
            if (!listToShareId) return;

            const list = pomodoroState.lists.find(l => l.id === listToShareId);
            if (!list) return;

            const listToExport = {
                name: list.name,
                tasks: list.tasks,
                exportDate: new Date().toISOString(),
                exportedFrom: 'Pomodoro Task Manager'
            };

            const dataStr = JSON.stringify(listToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            const safeFileName = list.name.replace(/[^a-z0-9]/gi, '-').toLowerCase();
            link.download = `pomodoro-list-${safeFileName}-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);

            hideShareModal();
        }

        function shareListCopyToClipboard() {
            if (!listToShareId) return;

            const list = pomodoroState.lists.find(l => l.id === listToShareId);
            if (!list) return;

            const listData = {
                name: list.name,
                tasks: list.tasks,
                exportDate: new Date().toISOString(),
                exportedFrom: 'Pomodoro Task Manager'
            };

            const json = JSON.stringify(listData, null, 2);

            navigator.clipboard.writeText(json).then(() => {
                // Show success feedback
                const btn = document.getElementById('shareListCopyBtn');
                const originalText = btn.querySelector('.share-option-title').textContent;
                btn.querySelector('.share-option-title').textContent = ' Copied!';
                btn.style.borderColor = '#2ecc71';
                btn.style.background = '#d5f4e6';

                setTimeout(() => {
                    btn.querySelector('.share-option-title').textContent = originalText;
                    btn.style.borderColor = '';
                    btn.style.background = '';
                }, 2000);
            }).catch(err => {
                alert('Failed to copy to clipboard');
                console.error('Copy failed:', err);
            });
        }

        function switchToList(listId) {
            if (!listId) {
                hideListContent();
                return;
            }

            pomodoroState.currentListId = listId;
            showListContent();
            renderTasks();
            saveData();
        }

        function updateListSelector() {
            const dropdownItems = document.getElementById('list-dropdown-items');
            dropdownItems.innerHTML = '';

            pomodoroState.lists.forEach(list => {
                const item = document.createElement('div');
                item.className = 'list-dropdown-item';
                if (list.id === pomodoroState.currentListId) {
                    item.classList.add('active');
                }

                const nameSpan = document.createElement('span');
                nameSpan.textContent = list.name;
                item.appendChild(nameSpan);

                if (list.id === pomodoroState.currentListId) {
                    const checkIcon = document.createElement('i');
                    checkIcon.className = 'fas fa-check list-dropdown-item-check';
                    item.appendChild(checkIcon);
                }

                item.addEventListener('click', () => {
                    switchToList(list.id);
                    hideListDropdown();
                });

                dropdownItems.appendChild(item);
            });
        }

        function toggleListDropdown() {
            const dropdown = document.getElementById('list-selector-dropdown');
            dropdown.classList.toggle('hidden');
            updateListSelector();
        }

        function hideListDropdown() {
            const dropdown = document.getElementById('list-selector-dropdown');
            dropdown.classList.add('hidden');
        }

        function showListContent() {
            document.getElementById('no-list-message').style.display = 'none';
            document.getElementById('list-content').style.display = 'flex';
            hideListDropdown();

            const currentList = getCurrentList();
            if (currentList) {
                document.getElementById('current-list-name').textContent = currentList.name;
            }
        }

        function hideListContent() {
            document.getElementById('no-list-message').style.display = 'flex';
            document.getElementById('list-content').style.display = 'none';
            pomodoroState.currentListId = null;
        }

        function getCurrentList() {
            return pomodoroState.lists.find(l => l.id === pomodoroState.currentListId);
        }

        // Task Management Functions
        function generateTaskId() {
            return 'task-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        }

        function addTask(parentTaskId = null) {
            const currentList = getCurrentList();
            if (!currentList) return;

            const newTaskInput = document.getElementById('new-task-input');
            const taskText = newTaskInput.value.trim();

            if (!taskText) return;

            const newTask = {
                id: generateTaskId(),
                text: taskText,
                completed: false,
                deadline: null,
                subtasks: []
            };

            if (parentTaskId) {
                addSubtaskToParent(currentList.tasks, parentTaskId, newTask);
            } else {
                currentList.tasks.push(newTask);
            }

            newTaskInput.value = '';
            renderTasks();
            saveData();
        }

        function addSubtaskToParent(tasks, parentId, subtask) {
            for (let task of tasks) {
                if (task.id === parentId) {
                    if (!task.subtasks) task.subtasks = [];
                    task.subtasks.push(subtask);
                    return true;
                }
                if (task.subtasks && task.subtasks.length > 0) {
                    if (addSubtaskToParent(task.subtasks, parentId, subtask)) {
                        return true;
                    }
                }
            }
            return false;
        }

        function addSubtask(parentTaskId) {
            removeAllInlineInputs();

            const taskElement = document.querySelector(`[data-task-id="${parentTaskId}"]`);
            if (!taskElement) return;

            taskElement.classList.remove('collapsed');
            const expandIndicator = taskElement.querySelector('.task-expand-indicator');
            if (expandIndicator) {
                expandIndicator.classList.remove('collapsed');
            }

            let subtasksList = taskElement.querySelector('.pomodoro-subtasks');
            if (!subtasksList) {
                subtasksList = document.createElement('ul');
                subtasksList.className = 'pomodoro-subtasks';
                taskElement.appendChild(subtasksList);
            }

            const inputLi = document.createElement('li');
            inputLi.className = 'pomodoro-task-item inline-subtask-input';

            const inputContent = document.createElement('div');
            inputContent.className = 'pomodoro-task-content';

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'inline-task-input';
            input.placeholder = 'Enter subtask...';

            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'inline-input-buttons';

            const saveBtn = document.createElement('button');
            saveBtn.className = 'inline-input-btn save';
            saveBtn.innerHTML = '<i class="fas fa-check"></i>';
            saveBtn.title = 'Save';

            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'inline-input-btn cancel';
            cancelBtn.innerHTML = '<i class="fas fa-times"></i>';
            cancelBtn.title = 'Cancel';

            buttonContainer.appendChild(saveBtn);
            buttonContainer.appendChild(cancelBtn);

            inputContent.appendChild(input);
            inputContent.appendChild(buttonContainer);
            inputLi.appendChild(inputContent);
            subtasksList.insertBefore(inputLi, subtasksList.firstChild);

            setTimeout(() => input.focus(), 0);

            const saveSubtask = () => {
                const subtaskText = input.value.trim();
                if (!subtaskText) {
                    inputLi.remove();
                    return;
                }

                const currentList = getCurrentList();
                if (!currentList) return;

                const newSubtask = {
                    id: generateTaskId(),
                    text: subtaskText,
                    completed: false,
                    deadline: null,
                    subtasks: []
                };

                addSubtaskToParent(currentList.tasks, parentTaskId, newSubtask);
                renderTasks();
                saveData();
            };

            const cancelSubtask = () => {
                inputLi.remove();
                if (subtasksList.children.length === 0) {
                    subtasksList.remove();
                }
            };

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveSubtask();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelSubtask();
                }
            });

            saveBtn.addEventListener('click', saveSubtask);
            cancelBtn.addEventListener('click', cancelSubtask);
        }

        function removeAllInlineInputs() {
            const inlineInputs = document.querySelectorAll('.inline-subtask-input');
            inlineInputs.forEach(input => input.remove());
        }

        function toggleTaskCompletion(taskId) {
            const currentList = getCurrentList();
            if (!currentList) return;

            toggleTaskInArray(currentList.tasks, taskId);
            renderTasks();
            saveData();
        }

        function toggleTaskInArray(tasks, taskId) {
            for (let task of tasks) {
                if (task.id === taskId) {
                    task.completed = !task.completed;
                    if (task.subtasks) {
                        setSubtasksCompleted(task.subtasks, task.completed);
                    }
                    return true;
                }
                if (task.subtasks && task.subtasks.length > 0) {
                    if (toggleTaskInArray(task.subtasks, taskId)) {
                        return true;
                    }
                }
            }
            return false;
        }

        function setSubtasksCompleted(tasks, completed) {
            tasks.forEach(task => {
                task.completed = completed;
                if (task.subtasks) {
                    setSubtasksCompleted(task.subtasks, completed);
                }
            });
        }

        function deleteTask(taskId) {
            const currentList = getCurrentList();
            if (!currentList) return;

            if (!confirm('Delete this task?')) return;

            currentList.tasks = deleteTaskFromArray(currentList.tasks, taskId);
            renderTasks();
            saveData();
        }

        function deleteTaskFromArray(tasks, taskId) {
            return tasks.filter(task => {
                if (task.id === taskId) return false;
                if (task.subtasks) {
                    task.subtasks = deleteTaskFromArray(task.subtasks, taskId);
                }
                return true;
            });
        }

        function toggleTaskExpansion(taskId) {
            const currentList = getCurrentList();
            if (!currentList) return;

            const task = findTaskById(currentList.tasks, taskId);
            if (task) {
                task.collapsed = !task.collapsed;
                saveData();
            }

            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            if (taskElement) {
                taskElement.classList.toggle('collapsed');
                const indicator = taskElement.querySelector('.task-expand-indicator');
                if (indicator) {
                    indicator.classList.toggle('collapsed');
                }
            }
        }

        function findTaskById(tasks, taskId) {
            for (let task of tasks) {
                if (task.id === taskId) {
                    return task;
                }
                if (task.subtasks && task.subtasks.length > 0) {
                    const found = findTaskById(task.subtasks, taskId);
                    if (found) return found;
                }
            }
            return null;
        }

        // Automatic Deadline Updates
        function startDeadlineAutoUpdate() {
            pomodoroState.lastUpdateDate = new Date().toDateString();

            pomodoroState.deadlineUpdateInterval = setInterval(() => {
                const currentDate = new Date().toDateString();

                if (currentDate !== pomodoroState.lastUpdateDate) {
                    pomodoroState.lastUpdateDate = currentDate;
                    updateDeadlineDisplays();
                } else {
                    const hasTasksDueToday = checkForTasksDueToday();
                    if (hasTasksDueToday) {
                        updateDeadlineDisplays();
                    }
                }
            }, 60000);
        }

        function checkForTasksDueToday() {
            const currentList = getCurrentList();
            if (!currentList || !currentList.tasks) return false;

            let hasTodayTasks = false;

            function checkTasks(tasks) {
                for (let task of tasks) {
                    if (task.deadline && getDeadlineCategory(task.deadline) === 'today') {
                        hasTodayTasks = true;
                        return;
                    }
                    if (task.subtasks && task.subtasks.length > 0) {
                        checkTasks(task.subtasks);
                    }
                }
            }

            checkTasks(currentList.tasks);
            return hasTodayTasks;
        }

        function updateDeadlineDisplays() {
            const currentList = getCurrentList();
            if (currentList && currentList.tasks && currentList.tasks.length > 0) {
                renderTasks();
            }
        }

        // Deadline Utility Functions
        function getDeadlineDate(deadlineType) {
            const today = new Date();

            switch (deadlineType) {
                case 'today':
                    today.setHours(18, 0, 0, 0);
                    return today.toISOString();
                case 'week':
                    const endOfWeek = new Date(today);
                    endOfWeek.setDate(today.getDate() + (7 - today.getDay()));
                    endOfWeek.setHours(18, 0, 0, 0);
                    return endOfWeek.toISOString();
                case 'next-week':
                    const endOfNextWeek = new Date(today);
                    endOfNextWeek.setDate(today.getDate() + (14 - today.getDay()));
                    endOfNextWeek.setHours(18, 0, 0, 0);
                    return endOfNextWeek.toISOString();
                case 'month':
                    const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    endOfMonth.setHours(18, 0, 0, 0);
                    return endOfMonth.toISOString();
                default:
                    return null;
            }
        }

        function getDeadlineCategory(deadlineISO) {
            if (!deadlineISO) return null;

            const deadline = new Date(deadlineISO);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const deadlineDay = new Date(deadline);
            deadlineDay.setHours(0, 0, 0, 0);

            const diffTime = deadlineDay - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays < 0) return 'overdue';
            if (diffDays === 0) return 'today';
            if (diffDays <= 7) return 'week';
            if (diffDays <= 14) return 'next-week';
            return 'month';
        }

        function formatDeadlineText(deadlineISO) {
            if (!deadlineISO) return 'Set deadline';

            const deadline = new Date(deadlineISO);
            const now = new Date();
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const deadlineDay = new Date(deadline);
            deadlineDay.setHours(0, 0, 0, 0);

            const diffTime = deadlineDay - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays < 0) {
                return `Overdue (${Math.abs(diffDays)}d)`;
            }

            if (diffDays === 0) {
                const timeRemaining = deadline - now;
                const hoursRemaining = Math.floor(timeRemaining / (1000 * 60 * 60));
                const minutesRemaining = Math.ceil(timeRemaining / (1000 * 60));

                if (timeRemaining <= 0) {
                    return 'Due now';
                }

                if (hoursRemaining < 1) {
                    return `${minutesRemaining}m left`;
                }

                return `${hoursRemaining}h left`;
            }

            if (diffDays === 1) return 'Tomorrow';
            if (diffDays <= 7) return `${diffDays} days`;

            const options = { month: 'short', day: 'numeric' };
            return deadline.toLocaleDateString(undefined, options);
        }

        // View Toggle
        function toggleViewMode() {
            const viewToggleBtn = document.getElementById('view-toggle-btn');

            if (pomodoroState.viewMode === 'normal') {
                pomodoroState.viewMode = 'deadline';
                viewToggleBtn.classList.add('view-toggle-active');
                viewToggleBtn.title = 'Show normal view';
            } else {
                pomodoroState.viewMode = 'normal';
                viewToggleBtn.classList.remove('view-toggle-active');
                viewToggleBtn.title = 'Show deadline view';
            }

            renderTasks();
        }

        // Custom Date Modal Functions
        function showCustomDateModal(taskId) {
            pomodoroState.currentDeadlineTaskId = taskId;
            const modal = document.getElementById('custom-date-modal');
            const input = document.getElementById('custom-date-input');

            const today = new Date().toISOString().split('T')[0];
            input.min = today;
            input.value = today;

            modal.style.display = 'flex';
            setTimeout(() => input.focus(), 100);
        }

        function hideCustomDateModal() {
            const modal = document.getElementById('custom-date-modal');
            modal.style.display = 'none';
            pomodoroState.currentDeadlineTaskId = null;
        }

        function saveCustomDate() {
            const input = document.getElementById('custom-date-input');
            const dateValue = input.value;

            if (!dateValue || !pomodoroState.currentDeadlineTaskId) return;

            const selectedDate = new Date(dateValue);
            selectedDate.setHours(18, 0, 0, 0);

            setTaskDeadline(pomodoroState.currentDeadlineTaskId, selectedDate.toISOString());
            hideCustomDateModal();
        }

        // Deadline Management
        function setTaskDeadline(taskId, deadlineISO) {
            const currentList = getCurrentList();
            if (!currentList) return;

            updateTaskDeadline(currentList.tasks, taskId, deadlineISO);
            renderTasks();
            saveData();
        }

        function updateTaskDeadline(tasks, taskId, deadlineISO) {
            for (let task of tasks) {
                if (task.id === taskId) {
                    task.deadline = deadlineISO;
                    return true;
                }
                if (task.subtasks && task.subtasks.length > 0) {
                    if (updateTaskDeadline(task.subtasks, taskId, deadlineISO)) {
                        return true;
                    }
                }
            }
            return false;
        }

        function toggleDeadlineDropdown(taskId, event) {
            event.stopPropagation();

            document.querySelectorAll('.deadline-options').forEach(dropdown => {
                if (dropdown.dataset.taskId !== taskId) {
                    dropdown.classList.remove('show');
                }
            });

            const dropdown = document.querySelector(`[data-task-id="${taskId}"] .deadline-options`);
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }

        function handleDeadlineOption(taskId, option) {
            if (option === 'clear') {
                setTaskDeadline(taskId, null);
            } else if (option === 'custom') {
                showCustomDateModal(taskId);
            } else {
                const deadlineDate = getDeadlineDate(option);
                setTaskDeadline(taskId, deadlineDate);
            }
        }

        // Create Deadline Dropdown Element
        function createDeadlineDropdown(task) {
            const dropdownContainer = document.createElement('div');
            dropdownContainer.className = 'task-deadline-dropdown';
            dropdownContainer.dataset.taskId = task.id;

            const badge = document.createElement('span');
            const category = getDeadlineCategory(task.deadline);
            badge.className = `deadline-badge${category ? ' ' + category : ''}`;
            badge.textContent = formatDeadlineText(task.deadline);
            badge.addEventListener('click', (e) => toggleDeadlineDropdown(task.id, e));

            const options = document.createElement('div');
            options.className = 'deadline-options';
            options.dataset.taskId = task.id;

            const deadlineOptions = [
                { value: 'today', label: 'End of day (6:00 PM)' },
                { value: 'week', label: 'End of week (6:00 PM)' },
                { value: 'next-week', label: 'End of next week (6:00 PM)' },
                { value: 'month', label: 'In one month (6:00 PM)' },
                { value: 'custom', label: 'Custom date...' }
            ];

            if (task.deadline) {
                deadlineOptions.push({ value: 'clear', label: 'Clear deadline', class: 'clear' });
            }

            deadlineOptions.forEach(opt => {
                const optEl = document.createElement('div');
                optEl.className = `deadline-option${opt.class ? ' ' + opt.class : ''}`;
                optEl.textContent = opt.label;
                optEl.addEventListener('click', () => {
                    handleDeadlineOption(task.id, opt.value);
                    options.classList.remove('show');
                });
                options.appendChild(optEl);
            });

            dropdownContainer.appendChild(badge);
            dropdownContainer.appendChild(options);

            return dropdownContainer;
        }

        // Render Deadline View
        function renderDeadlineView() {
            const currentList = getCurrentList();
            const tasksList = document.getElementById('pomodoro-tasks');
            const tasksCounter = document.getElementById('tasks-counter');

            if (!currentList || !currentList.tasks) return;

            tasksList.innerHTML = '';

            const allTasks = [];
            function collectTasks(tasks, parentId = null) {
                tasks.forEach(task => {
                    allTasks.push({ ...task, parentId });
                    if (task.subtasks && task.subtasks.length > 0) {
                        collectTasks(task.subtasks, task.id);
                    }
                });
            }
            collectTasks(currentList.tasks);

            const grouped = {
                overdue: [],
                today: [],
                week: [],
                'next-week': [],
                month: [],
                later: [],
                none: []
            };

            allTasks.forEach(task => {
                const category = getDeadlineCategory(task.deadline);
                if (!category) {
                    grouped.none.push(task);
                } else {
                    grouped[category].push(task);
                }
            });

            Object.keys(grouped).forEach(key => {
                if (key !== 'none') {
                    grouped[key].sort((a, b) => {
                        if (!a.deadline) return 1;
                        if (!b.deadline) return -1;
                        return new Date(a.deadline) - new Date(b.deadline);
                    });
                }
            });

            let totalCount = allTasks.length;
            let completedCount = allTasks.filter(t => t.completed).length;
            tasksCounter.textContent = `${completedCount}/${totalCount} completed`;

            const sections = [
                { key: 'overdue', label: 'Overdue', class: 'overdue' },
                { key: 'today', label: 'Today', class: 'today' },
                { key: 'week', label: 'This Week', class: 'week' },
                { key: 'next-week', label: 'Next Week' },
                { key: 'month', label: 'This Month' },
                { key: 'later', label: 'Later' },
                { key: 'none', label: 'No Deadline' }
            ];

            sections.forEach(section => {
                const tasks = grouped[section.key];
                if (tasks.length === 0) return;

                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'deadline-view-section';

                const header = document.createElement('div');
                header.className = `deadline-section-header${section.class ? ' ' + section.class : ''}`;
                header.innerHTML = `${section.label}<span class="deadline-section-count">(${tasks.length})</span>`;

                const taskList = document.createElement('ul');
                taskList.className = 'pomodoro-task-list';

                tasks.forEach(task => {
                    const li = renderTaskItemSimple(task);
                    taskList.appendChild(li);
                });

                sectionDiv.appendChild(header);
                sectionDiv.appendChild(taskList);
                tasksList.appendChild(sectionDiv);
            });
        }

        // Helper function to render a simplified task item for deadline view
        function renderTaskItemSimple(task) {
            if (task.completed && pomodoroState.timerSettings.completedTasksDisplay === 'hide') {
                const li = document.createElement('li');
                li.style.display = 'none';
                return li;
            }

            const li = document.createElement('li');
            li.className = `pomodoro-task-item${task.completed ? ' pomodoro-task-completed' : ''}`;
            li.dataset.taskId = task.id;

            const taskContent = document.createElement('div');
            taskContent.className = 'pomodoro-task-content';

            const spacer = document.createElement('span');
            spacer.style.width = '14px';
            spacer.style.flexShrink = '0';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'pomodoro-task-checkbox';
            checkbox.checked = task.completed;
            checkbox.addEventListener('change', () => toggleTaskCompletion(task.id));

            const textEl = document.createElement('div');
            textEl.className = 'pomodoro-task-text';
            textEl.textContent = task.text;

            const deadlineDropdown = createDeadlineDropdown(task);

            taskContent.appendChild(spacer);
            taskContent.appendChild(checkbox);
            taskContent.appendChild(textEl);
            taskContent.appendChild(deadlineDropdown);
            li.appendChild(taskContent);

            return li;
        }

        // Render Tasks
        function renderTasks() {
            const currentList = getCurrentList();
            const tasksList = document.getElementById('pomodoro-tasks');
            const tasksCounter = document.getElementById('tasks-counter');

            tasksList.innerHTML = '';

            if (!currentList || !currentList.tasks || currentList.tasks.length === 0) {
                tasksList.innerHTML = '<li class="pomodoro-no-tasks">No tasks added yet. Add a task to get started.</li>';
                tasksCounter.textContent = '0/0 completed';
                return;
            }

            if (pomodoroState.viewMode === 'deadline') {
                renderDeadlineView();
                return;
            }

            let totalCount = 0;
            let completedCount = 0;

            function countTasks(tasks) {
                tasks.forEach(task => {
                    totalCount++;
                    if (task.completed) completedCount++;
                    if (task.subtasks && task.subtasks.length > 0) {
                        countTasks(task.subtasks);
                    }
                });
            }

            countTasks(currentList.tasks);
            tasksCounter.textContent = `${completedCount}/${totalCount} completed`;

            function renderTaskItem(task, parentElement) {
                if (task.completed && pomodoroState.timerSettings.completedTasksDisplay === 'hide') {
                    return;
                }

                const li = document.createElement('li');
                li.className = `pomodoro-task-item${task.completed ? ' pomodoro-task-completed' : ''}`;
                li.dataset.taskId = task.id;

                if (task.collapsed) {
                    li.classList.add('collapsed');
                }

                const taskContent = document.createElement('div');
                taskContent.className = 'pomodoro-task-content';

                const hasSubtasks = task.subtasks && task.subtasks.length > 0;
                const expandIndicator = document.createElement('span');
                expandIndicator.className = `task-expand-indicator${task.collapsed ? ' collapsed' : ''}`;
                if (hasSubtasks) {
                    expandIndicator.innerHTML = '<i class="fas fa-chevron-down"></i>';
                    expandIndicator.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleTaskExpansion(task.id);
                    });
                } else {
                    expandIndicator.style.visibility = 'hidden';
                }

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'pomodoro-task-checkbox';
                checkbox.checked = task.completed;
                checkbox.addEventListener('change', () => toggleTaskCompletion(task.id));

                const textEl = document.createElement('div');
                textEl.className = 'pomodoro-task-text';
                textEl.textContent = task.text;

                const deadlineDropdown = createDeadlineDropdown(task);

                const controls = document.createElement('div');
                controls.className = 'pomodoro-task-controls';

                const addSubtaskBtn = document.createElement('button');
                addSubtaskBtn.className = 'pomodoro-task-btn pomodoro-task-add-subtask';
                addSubtaskBtn.innerHTML = '<i class="fas fa-level-down-alt"></i>';
                addSubtaskBtn.title = 'Add subtask';
                addSubtaskBtn.addEventListener('click', () => addSubtask(task.id));

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'pomodoro-task-btn pomodoro-task-delete';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.title = 'Delete task';
                deleteBtn.addEventListener('click', () => deleteTask(task.id));

                controls.appendChild(addSubtaskBtn);
                controls.appendChild(deleteBtn);

                taskContent.appendChild(expandIndicator);
                taskContent.appendChild(checkbox);
                taskContent.appendChild(textEl);
                taskContent.appendChild(deadlineDropdown);
                taskContent.appendChild(controls);
                li.appendChild(taskContent);

                if (hasSubtasks) {
                    const subtasksList = document.createElement('ul');
                    subtasksList.className = 'pomodoro-subtasks';
                    task.subtasks.forEach(subtask => renderTaskItem(subtask, subtasksList));
                    li.appendChild(subtasksList);
                }

                parentElement.appendChild(li);
            }

            currentList.tasks.forEach(task => renderTaskItem(task, tasksList));
        }

        // Setup slider value display
        function setupSlider(sliderId, valueId) {
            const slider = document.getElementById(sliderId);
            const valueEl = document.getElementById(valueId);
            slider.addEventListener('input', function() {
                valueEl.textContent = this.value;
            });
        }

        // Timer Functions
        function getCurrentSessionDuration() {
            switch (pomodoroState.timerState.currentSession) {
                case 'work':
                    return pomodoroState.timerSettings.workDuration * 60;
                case 'shortBreak':
                    return pomodoroState.timerSettings.shortBreakDuration * 60;
                case 'longBreak':
                    return pomodoroState.timerSettings.longBreakDuration * 60;
                default:
                    return 25 * 60;
            }
        }

        function updateTimerDisplay() {
            const timeDisplay = document.getElementById('pomodoro-time');
            const sessionDisplay = document.getElementById('pomodoro-session');
            const startButton = document.getElementById('pomodoro-start');
            const timerDisplay = document.querySelector('.pomodoro-timer-display');
            const timerProgress = document.querySelector('.timer-progress');

            timerDisplay.classList.remove('work-session', 'short-break-session', 'long-break-session');

            if (pomodoroState.timerState.currentSession === 'work') {
                timerDisplay.classList.add('work-session');
            } else if (pomodoroState.timerState.currentSession === 'shortBreak') {
                timerDisplay.classList.add('short-break-session');
            } else if (pomodoroState.timerState.currentSession === 'longBreak') {
                timerDisplay.classList.add('long-break-session');
            }

            const minutes = Math.floor(pomodoroState.timerState.timeRemaining / 60);
            const seconds = pomodoroState.timerState.timeRemaining % 60;
            timeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            const totalDuration = getCurrentSessionDuration();
            const percentComplete = ((totalDuration - pomodoroState.timerState.timeRemaining) / totalDuration) * 100;
            timerProgress.style.width = `${percentComplete}%`;

            let sessionText = "";
            if (pomodoroState.timerState.currentSession === 'work') {
                const currentWorkSession = (pomodoroState.timerState.sessionCount % pomodoroState.timerSettings.sessionsBeforeLongBreak) + 1;
                sessionText = `Work ${currentWorkSession}/${pomodoroState.timerSettings.sessionsBeforeLongBreak}`;
            } else if (pomodoroState.timerState.currentSession === 'shortBreak') {
                sessionText = `Short Break`;
            } else {
                sessionText = `Long Break`;
            }
            sessionDisplay.textContent = sessionText;

            if (pomodoroState.timerState.isRunning) {
                startButton.innerHTML = '<i class="fas fa-pause"></i>';
                startButton.setAttribute('aria-label', 'Pause timer');
                startButton.classList.add('active');
            } else {
                startButton.innerHTML = '<i class="fas fa-play"></i>';
                startButton.setAttribute('aria-label', 'Start timer');
                startButton.classList.remove('active');
            }
        }

        function toggleTimer() {
            if (pomodoroState.timerState.isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function startTimer() {
            if (pomodoroState.timerState.isRunning) return;

            if (!pomodoroState.timerState.pauseTime) {
                pomodoroState.timerState.startTime = Date.now();
            } else {
                const pauseDuration = Date.now() - pomodoroState.timerState.pauseTime;
                pomodoroState.timerState.startTime += pauseDuration;
                pomodoroState.timerState.pauseTime = null;
            }

            pomodoroState.timerState.isRunning = true;
            updateTimerDisplay();

            pomodoroState.timerState.timerInterval = setInterval(function() {
                const elapsed = Math.floor((Date.now() - pomodoroState.timerState.startTime) / 1000);
                pomodoroState.timerState.timeRemaining = Math.max(0, getCurrentSessionDuration() - elapsed);

                updateTimerDisplay();

                if (pomodoroState.timerState.timeRemaining <= 0) {
                    handleTimerComplete();
                }
            }, 1000);
        }

        function pauseTimer() {
            if (!pomodoroState.timerState.isRunning) return;

            clearInterval(pomodoroState.timerState.timerInterval);
            pomodoroState.timerState.timerInterval = null;
            pomodoroState.timerState.pauseTime = Date.now();
            pomodoroState.timerState.isRunning = false;
            updateTimerDisplay();
        }

        function resetTimer() {
            if (pomodoroState.timerState.isRunning) {
                pauseTimer();
            }

            pomodoroState.timerState.timeRemaining = getCurrentSessionDuration();
            pomodoroState.timerState.startTime = null;
            pomodoroState.timerState.pauseTime = null;
            updateTimerDisplay();
        }

        function handleTimerComplete() {
            clearInterval(pomodoroState.timerState.timerInterval);
            pomodoroState.timerState.timerInterval = null;
            pomodoroState.timerState.isRunning = false;

            playTimerCompleteSound();
            showTimerNotification();

            const completedSession = pomodoroState.timerState.currentSession;

            if (completedSession === 'work') {
                pomodoroState.timerState.sessionCount++;
            }

            let nextSession;
            if (completedSession === 'work') {
                if (pomodoroState.timerState.sessionCount % pomodoroState.timerSettings.sessionsBeforeLongBreak === 0) {
                    nextSession = 'longBreak';
                } else {
                    nextSession = 'shortBreak';
                }
            } else {
                nextSession = 'work';
            }

            switchSession(nextSession);
        }

        function skipCurrentSession() {
            pauseTimer();

            const completedSession = pomodoroState.timerState.currentSession;

            if (completedSession === 'work') {
                pomodoroState.timerState.sessionCount++;
            }

            let nextSession;
            if (completedSession === 'work') {
                if (pomodoroState.timerState.sessionCount % pomodoroState.timerSettings.sessionsBeforeLongBreak === 0) {
                    nextSession = 'longBreak';
                } else {
                    nextSession = 'shortBreak';
                }
            } else {
                nextSession = 'work';
            }

            switchSession(nextSession);
            updateTimerDisplay();
        }

        function switchSession(sessionType) {
            pomodoroState.timerState.currentSession = sessionType;
            pomodoroState.timerState.timeRemaining = getCurrentSessionDuration();
            pomodoroState.timerState.startTime = null;
            pomodoroState.timerState.pauseTime = null;
            updateTimerDisplay();
        }

        function playTimerCompleteSound() {
            try {
                const context = new AudioContext();
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();

                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(
                    pomodoroState.timerState.currentSession === 'work' ? 800 : 600,
                    context.currentTime
                );

                gainNode.gain.setValueAtTime(0.1, context.currentTime);

                oscillator.connect(gainNode);
                gainNode.connect(context.destination);

                oscillator.start();
                oscillator.stop(context.currentTime + 0.5);
            } catch (error) {
                console.error('Error playing sound:', error);
            }
        }

        function showTimerNotification() {
            const session = pomodoroState.timerState.currentSession;
            let title, message;

            if (session === 'work') {
                title = 'Work Session Complete!';
                message = 'Time for a break. Great work!';
            } else if (session === 'shortBreak') {
                title = 'Short Break Complete!';
                message = 'Ready to get back to work?';
            } else {
                title = 'Long Break Complete!';
                message = 'Feeling refreshed? Time for the next work session!';
            }

            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: message,
                    icon: 'https://i.imgur.com/iIODsNl.png'
                });
            }
        }

        // Settings Functions
        function showSettings() {
            const overlay = document.getElementById('settings-overlay');
            overlay.classList.add('active');

            document.getElementById('work-duration').value = pomodoroState.timerSettings.workDuration;
            document.getElementById('work-duration-value').textContent = pomodoroState.timerSettings.workDuration;
            document.getElementById('short-break').value = pomodoroState.timerSettings.shortBreakDuration;
            document.getElementById('short-break-value').textContent = pomodoroState.timerSettings.shortBreakDuration;
            document.getElementById('long-break').value = pomodoroState.timerSettings.longBreakDuration;
            document.getElementById('long-break-value').textContent = pomodoroState.timerSettings.longBreakDuration;
            document.getElementById('sessions-count').value = pomodoroState.timerSettings.sessionsBeforeLongBreak;
            document.getElementById('sessions-value').textContent = pomodoroState.timerSettings.sessionsBeforeLongBreak;

            if (pomodoroState.timerSettings.completedTasksDisplay === 'strikethrough') {
                document.getElementById('strikethrough').checked = true;
            } else {
                document.getElementById('hide').checked = true;
            }
        }

        function hideSettings() {
            document.getElementById('settings-overlay').classList.remove('active');
        }

        function showTemplatesModal() {
            const modal = document.getElementById('templates-modal');
            const templatesList = document.getElementById('templates-list');

            // Clear existing content
            templatesList.innerHTML = '';

            // Get template lists (filter out user-created lists)
            const templateLists = pomodoroState.lists.filter(list =>
                list.id.startsWith('template-')
            );

            if (templateLists.length === 0) {
                templatesList.innerHTML = '<p style="text-align: center; color: var(--text-tertiary);">No templates available</p>';
            } else {
                templateLists.forEach(list => {
                    const card = document.createElement('div');
                    card.className = 'template-card';

                    // Count total tasks (including subtasks)
                    const countTasks = (tasks) => {
                        let count = tasks.length;
                        tasks.forEach(task => {
                            if (task.subtasks) {
                                count += countTasks(task.subtasks);
                            }
                        });
                        return count;
                    };
                    const taskCount = countTasks(list.tasks);

                    // Get description based on list name
                    let description = '';
                    if (list.name.includes('Research Article')) {
                        description = 'Complete guide for writing a compelling introduction to your research article';
                    } else if (list.name.includes('Business Proposal')) {
                        description = 'Step-by-step process for creating a comprehensive business proposal';
                    } else if (list.name.includes('AI in Education')) {
                        description = 'Structured approach to writing a white paper on AI in education';
                    } else if (list.name.includes('Course Proposal')) {
                        description = 'Detailed workflow for crafting an effective course proposal';
                    }

                    card.innerHTML = `
                        <h4 class="template-card-title">${list.name}</h4>
                        <p class="template-card-description">${description}</p>
                        <div class="template-card-meta">
                            <i class="fas fa-tasks"></i>
                            <span>${taskCount} tasks</span>
                        </div>
                    `;

                    card.addEventListener('click', () => {
                        selectTemplate(list.id);
                    });

                    templatesList.appendChild(card);
                });
            }

            modal.classList.add('active');
        }

        function hideTemplatesModal() {
            document.getElementById('templates-modal').classList.remove('active');
        }

        function selectTemplate(listId) {
            pomodoroState.currentListId = listId;
            hideTemplatesModal();
            showListContent();
            renderTasks();
            saveData();
        }

        // Options Dropdown Functions
        function toggleOptionsDropdown() {
            const menu = document.getElementById('optionsDropdownMenu');
            menu.classList.toggle('show');
        }

        function showAbout() {
            alert('Pomodoro Task Manager\n\nA productivity app combining the Pomodoro Technique with task management.\n\nBuild better habits, one session at a time.');
            document.getElementById('optionsDropdownMenu').classList.remove('show');
        }

        function reportBug() {
            window.open('https://docs.google.com/forms/d/e/1FAIpQLScdkrinM5XB9jtV1I48v7CbrRZwPmaQP96Q_a9vJFlLG6gQUQ/viewform?usp=publish-editor', '_blank');
            document.getElementById('optionsDropdownMenu').classList.remove('show');
        }

        function shareViaEmail() {
            if (!pomodoroState.currentListId) {
                alert('Please select or create a list first');
                document.getElementById('optionsDropdownMenu').classList.remove('show');
                return;
            }

            const currentList = getCurrentList();
            if (!currentList) {
                alert('No list selected');
                document.getElementById('optionsDropdownMenu').classList.remove('show');
                return;
            }

            const listName = currentList.name;
            const taskCount = currentList.tasks.length;

            const listData = {
                name: currentList.name,
                tasks: currentList.tasks,
                exportDate: new Date().toISOString(),
                exportedFrom: 'Pomodoro Task Manager'
            };

            const subject = encodeURIComponent(`Shared Task List: ${listName}`);
            const body = encodeURIComponent(
                `Hi there!\n\n` +
                `I'm sharing a Pomodoro task list with you: "${listName}"\n` +
                `This list contains ${taskCount} task${taskCount !== 1 ? 's' : ''}.\n\n` +
                `===========================================\n` +
                `HOW TO IMPORT THIS LIST (for the recipient):\n` +
                `===========================================\n\n` +
                `STEP 1: Copy the .json file data\n` +
                `    Scroll down to the bottom of this email\n` +
                `    Select ALL the text between the lines marked "START COPYING HERE" and "STOP COPYING HERE"\n` +
                `    Copy it (Cmd+C or Ctrl+C)\n\n` +
                `STEP 2: Open the Pomodoro Task Manager\n` +
                `    Visit: https://landfair.github.io/PomodoroStandalone/ \n\n` +
                `STEP 3: Upload the list\n` +
                `    Click the Options button () in the top-right corner\n` +
                `    Select "Upload List"\n` +
                `    Choose the file you saved, or paste the data directly\n\n` +
                `That's it! The task list will appear in your Pomodoro app.\n\n\n` +
                `\n` +
                `>>> START COPYING HERE <<<\n` +
                `\n\n` +
                `${JSON.stringify(listData, null, 2)}\n\n` +
                `\n` +
                `>>> STOP COPYING HERE <<<\n` +
                ``
            );

            window.location.href = `mailto:?subject=${subject}&body=${body}`;
            document.getElementById('optionsDropdownMenu').classList.remove('show');
        }

        function exportData() {
            // Open download modal
            showDownloadModal();
            document.getElementById('optionsDropdownMenu').classList.remove('show');
        }

        function importData() {
            // Open upload modal
            showUploadModal();
            document.getElementById('optionsDropdownMenu').classList.remove('show');
        }

        // Download Modal Functions
        let selectedDownloadListId = null;

        function showDownloadModal() {
            const modal = document.getElementById('download-modal');
            const optionsContainer = document.getElementById('download-list-options');
            optionsContainer.innerHTML = '';
            selectedDownloadListId = null;

            if (pomodoroState.lists.length === 0) {
                optionsContainer.innerHTML = '<p style="text-align: center; color: var(--text-tertiary);">No lists available</p>';
                modal.classList.add('active');
                return;
            }

            pomodoroState.lists.forEach(list => {
                const option = document.createElement('div');
                option.className = 'download-list-option';
                option.dataset.listId = list.id;

                const radio = document.createElement('div');
                radio.className = 'download-list-option-radio';

                const name = document.createElement('span');
                name.className = 'download-list-option-name';
                name.textContent = list.name;

                const count = document.createElement('span');
                count.className = 'download-list-option-count';
                count.textContent = `${list.tasks.length} task${list.tasks.length !== 1 ? 's' : ''}`;

                option.appendChild(radio);
                option.appendChild(name);
                option.appendChild(count);

                option.addEventListener('click', () => {
                    // Remove selected class from all options
                    document.querySelectorAll('.download-list-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    selectedDownloadListId = list.id;
                    // Trigger download immediately
                    downloadSelectedList();
                });

                optionsContainer.appendChild(option);
            });

            modal.classList.add('active');
        }

        function hideDownloadModal() {
            document.getElementById('download-modal').classList.remove('active');
            selectedDownloadListId = null;
        }

        function downloadSelectedList() {
            if (!selectedDownloadListId) return;

            const list = pomodoroState.lists.find(l => l.id === selectedDownloadListId);
            if (!list) return;

            const listToExport = {
                name: list.name,
                tasks: list.tasks,
                exportDate: new Date().toISOString(),
                exportedFrom: 'Pomodoro Task Manager'
            };

            const dataStr = JSON.stringify(listToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            const safeFileName = list.name.replace(/[^a-z0-9]/gi, '-').toLowerCase();
            link.download = `pomodoro-list-${safeFileName}-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);

            hideDownloadModal();
        }

        // Upload Modal Functions
        function showUploadModal() {
            document.getElementById('upload-modal').classList.add('active');
            document.getElementById('upload-json-textarea').value = '';
        }

        function hideUploadModal() {
            document.getElementById('upload-modal').classList.remove('active');
            document.getElementById('upload-json-textarea').value = '';
        }

        function processUploadedList(data) {
            try {
                const importedList = JSON.parse(data);

                if (!importedList.name || !importedList.tasks) {
                    alert('Error: Invalid list file format');
                    return;
                }

                const existingList = pomodoroState.lists.find(l => l.name === importedList.name);
                let listName = importedList.name;

                if (existingList) {
                    const shouldRename = confirm(`A list named "${listName}" already exists. Would you like to rename the imported list?\n\nClick OK to rename, or Cancel to replace the existing list.`);

                    if (shouldRename) {
                        let counter = 1;
                        let newName = `${listName} (${counter})`;
                        while (pomodoroState.lists.find(l => l.name === newName)) {
                            counter++;
                            newName = `${listName} (${counter})`;
                        }
                        listName = newName;
                    } else {
                        pomodoroState.lists = pomodoroState.lists.filter(l => l.id !== existingList.id);
                    }
                }

                const newList = {
                    id: 'list-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                    name: listName,
                    tasks: importedList.tasks
                };

                pomodoroState.lists.push(newList);
                pomodoroState.currentListId = newList.id;

                saveData();
                showListContent();
                renderTasks();

                hideUploadModal();
                alert(`Successfully imported list: "${listName}"`);
            } catch (error) {
                alert('Error importing list: Invalid file format');
            }
        }

        function confirmUpload() {
            const textarea = document.getElementById('upload-json-textarea');
            const jsonData = textarea.value.trim();

            if (jsonData) {
                processUploadedList(jsonData);
            } else {
                alert('Please paste list data or select a file');
            }
        }

        function oldImportData() {
            // Same as uploadList - import a list
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const importedList = JSON.parse(event.target.result);

                            // Validate the imported list has required fields
                            if (!importedList.name || !importedList.tasks) {
                                alert('Error: Invalid list file format');
                                return;
                            }

                            // Check if a list with this name already exists
                            const existingList = pomodoroState.lists.find(l => l.name === importedList.name);
                            let listName = importedList.name;

                            if (existingList) {
                                const shouldRename = confirm(`A list named "${listName}" already exists. Would you like to rename the imported list?\n\nClick OK to rename, or Cancel to replace the existing list.`);

                                if (shouldRename) {
                                    // Add a number suffix to make it unique
                                    let counter = 1;
                                    let newName = `${listName} (${counter})`;
                                    while (pomodoroState.lists.find(l => l.name === newName)) {
                                        counter++;
                                        newName = `${listName} (${counter})`;
                                    }
                                    listName = newName;
                                } else {
                                    // Remove the existing list
                                    pomodoroState.lists = pomodoroState.lists.filter(l => l.id !== existingList.id);
                                }
                            }

                            // Create new list with a unique ID
                            const newList = {
                                id: 'list-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                                name: listName,
                                tasks: importedList.tasks
                            };

                            pomodoroState.lists.push(newList);
                            pomodoroState.currentListId = newList.id;

                            saveData();
                            showListContent();
                            renderTasks();

                            alert(`Successfully imported list: "${listName}"`);
                        } catch (error) {
                            alert('Error importing list: Invalid file format');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
            document.getElementById('optionsDropdownMenu').classList.remove('show');
        }

        function resetAllData() {
            if (confirm('This will delete ALL your lists and tasks. This cannot be undone. Are you sure?')) {
                if (confirm('Are you ABSOLUTELY sure? This action is permanent.')) {
                    localStorage.clear();
                    location.reload();
                }
            }
            document.getElementById('optionsDropdownMenu').classList.remove('show');
        }

        // Konami Code Easter Egg Functions
        function initKonamiCode() {
            const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
            let konamiIndex = 0;

            document.addEventListener('keydown', function(e) {
                const key = e.key.toLowerCase();

                if (key === konamiCode[konamiIndex] || e.key === konamiCode[konamiIndex]) {
                    konamiIndex++;

                    if (konamiIndex === konamiCode.length) {
                        showKonamiModal();
                        konamiIndex = 0;
                    }
                } else {
                    konamiIndex = 0;
                }
            });
        }

        function showKonamiModal() {
            const videos = [
                'https://www.youtube.com/embed/rhgwIhB58PA?autoplay=1',
                'https://www.youtube.com/embed/FWTNMzK9vG4?autoplay=1',
                'https://www.youtube.com/embed/0rIjFCNay2Q?autoplay=1',
                'https://www.youtube.com/embed/LKPwKFigF8U?autoplay=1',
                'https://www.youtube.com/embed/FWTNMzK9vG4?autoplay=1',
                'https://www.youtube.com/embed/LZgThq8t71s?autoplay=1'
            ];

            // Randomly select a video
            const randomVideo = videos[Math.floor(Math.random() * videos.length)];

            // Set the video source
            document.getElementById('konami-video').src = randomVideo;

            // Show the modal
            document.getElementById('konami-modal').classList.add('active');
        }

        function hideKonamiModal() {
            const modal = document.getElementById('konami-modal');
            const video = document.getElementById('konami-video');

            // Stop the video by clearing the src
            video.src = '';

            // Hide the modal
            modal.classList.remove('active');
        }

        function saveSettings() {
            pomodoroState.timerSettings.workDuration = parseInt(document.getElementById('work-duration').value);
            pomodoroState.timerSettings.shortBreakDuration = parseInt(document.getElementById('short-break').value);
            pomodoroState.timerSettings.longBreakDuration = parseInt(document.getElementById('long-break').value);
            pomodoroState.timerSettings.sessionsBeforeLongBreak = parseInt(document.getElementById('sessions-count').value);

            if (document.getElementById('strikethrough').checked) {
                pomodoroState.timerSettings.completedTasksDisplay = 'strikethrough';
            } else {
                pomodoroState.timerSettings.completedTasksDisplay = 'hide';
            }

            if (!pomodoroState.timerState.isRunning) {
                pomodoroState.timerState.timeRemaining = getCurrentSessionDuration();
            }

            saveData();
            updateTimerDisplay();
            renderTasks();
        }

        // Template Lists
        function createTemplateLists() {
            const templates = [
                {
                    id: 'template-research-intro-' + Date.now(),
                    name: 'Research Article Introduction',
                    tasks: [
                        {
                            id: generateTaskId(),
                            text: 'Write background paragraph introducing research context',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Find and read 5-7 key papers in the field',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'List the main theories used in existing research',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Draft 2-3 sentences summarizing what we know',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Write paragraph explaining the research gap',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'List 3-4 limitations in current research',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write 2-3 sentences on why addressing this gap matters',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Draft research questions and objectives section',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Write 1-2 clear research questions',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'List 3-5 specific research objectives',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Draft hypothesis statement (if using)',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Write significance paragraph',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Draft 2-3 sentences on theoretical contribution',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Draft 2-3 sentences on practical applications',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Write final paragraph outlining paper structure',
                            completed: false,
                            deadline: null,
                            subtasks: []
                        }
                    ]
                },
                {
                    id: 'template-business-proposal-' + Date.now(),
                    name: 'Business Proposal',
                    tasks: [
                        {
                            id: generateTaskId(),
                            text: 'Complete customer discovery interviews',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Create list of 3-5 target customer segments',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Schedule and conduct 10-15 customer interviews',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write up interview notes documenting pain points',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Summarize top 5 validated customer needs',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Research and write market analysis section',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Find data on total addressable market size',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Draft paragraph describing market opportunity/gap',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Create competitive analysis table with 5-7 competitors',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write 2-3 sentences stating unique value proposition',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Draft solution/product description section',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'List 5-8 key product/service features',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write paragraph connecting features to customer pain points',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Create implementation timeline/roadmap',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Build financial projections spreadsheet',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'List all startup costs with estimates',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Create 3-year revenue projection model',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Calculate and chart break-even point',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Write executive summary (1-2 pages)',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Draft opening paragraph on opportunity',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write 2 paragraphs summarizing solution and benefits',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Draft closing paragraph with funding ask and ROI',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        }
                    ]
                },
                {
                    id: 'template-ai-education-' + Date.now(),
                    name: 'AI in Education White Paper',
                    tasks: [
                        {
                            id: generateTaskId(),
                            text: 'Write scope and objectives section',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Document target audience',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'List key questions to address',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write boundaries for AI applications',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Write section reviewing current AI applications',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Write 2-3 paragraphs on personalized learning systems',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write 2-3 paragraphs on automated grading tools',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write 2-3 paragraphs on intelligent tutoring systems',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write 2-3 paragraphs on administrative AI applications',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Write section on benefits and opportunities',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Write 1-2 paragraphs on improved learning outcomes',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write 1-2 paragraphs on efficiency gains',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write 1-2 paragraphs on accessibility improvements',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Write section on challenges and ethical considerations',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Write 2-3 paragraphs addressing data privacy concerns',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write 2-3 paragraphs on algorithmic bias risks',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write 2-3 paragraphs on digital equity issues',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write section on teacher role transformation',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Write recommendations and best practices section',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Draft implementation strategies',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Draft policy framework recommendations',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Create evaluation metrics framework',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Draft conclusion and future outlook',
                            completed: false,
                            deadline: null,
                            subtasks: []
                        }
                    ]
                },
                {
                    id: 'template-course-proposal-' + Date.now(),
                    name: 'Course Proposal',
                    tasks: [
                        {
                            id: generateTaskId(),
                            text: 'Write course fundamentals section',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Write course title and description',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Document target student audience',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'List and explain prerequisites',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Specify credit hours and duration',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Draft learning outcomes and objectives',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Write 4-6 measurable learning objectives',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Create alignment matrix with program goals',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Map to institutional competencies',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Create course content and structure outline',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Create outline of weekly topics and modules',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Select and list textbooks and materials',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Document pedagogical approaches to use',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Create assessment strategy',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Create formative assessment tools and schedule',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Create summative assessment tools',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Create grading rubrics for major assignments',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Define grade distribution percentages',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Complete administrative requirements section',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Write justification for course need and demand',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Calculate and document enrollment projections',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'List and estimate resource requirements',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Complete all required institutional forms',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        },
                        {
                            id: generateTaskId(),
                            text: 'Draft complete sample syllabus',
                            completed: false,
                            deadline: null,
                            subtasks: [
                                {
                                    id: generateTaskId(),
                                    text: 'Write course policies section',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Write accessibility and accommodations statement',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                },
                                {
                                    id: generateTaskId(),
                                    text: 'Create detailed course schedule and timeline',
                                    completed: false,
                                    deadline: null,
                                    subtasks: []
                                }
                            ]
                        }
                    ]
                }
            ];

            return templates;
        }

        // Data Persistence (localStorage)
        function saveData() {
            localStorage.setItem('pomodoroState', JSON.stringify({
                timerSettings: pomodoroState.timerSettings,
                timerState: {
                    sessionCount: pomodoroState.timerState.sessionCount,
                    currentSession: pomodoroState.timerState.currentSession
                },
                lists: pomodoroState.lists,
                currentListId: pomodoroState.currentListId
            }));
        }

        function loadData() {
            const saved = localStorage.getItem('pomodoroState');

            if (saved) {
                const data = JSON.parse(saved);

                if (data.timerSettings) {
                    Object.assign(pomodoroState.timerSettings, data.timerSettings);
                }
                if (data.timerState) {
                    pomodoroState.timerState.sessionCount = data.timerState.sessionCount || 0;
                    pomodoroState.timerState.currentSession = data.timerState.currentSession || 'work';
                }
                if (data.lists) {
                    pomodoroState.lists = data.lists;
                }
                if (data.currentListId) {
                    pomodoroState.currentListId = data.currentListId;
                }

                pomodoroState.timerState.timeRemaining = getCurrentSessionDuration();
            }

            // Initialize template lists on first load
            if (!saved && pomodoroState.lists.length === 0) {
                pomodoroState.lists = createTemplateLists();
                // Don't set currentListId - let users start with blank view
                // They can select a template from the dropdown
                saveData();
            }

            if (pomodoroState.currentListId) {
                showListContent();
                renderTasks();
            } else {
                hideListContent();
            }
            updateTimerDisplay();
        }
    </script>
</body>
</html>
